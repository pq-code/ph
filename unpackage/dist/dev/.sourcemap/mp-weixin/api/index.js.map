{"version":3,"file":"index.js","sources":["api/index.js"],"sourcesContent":["import { wxService } from './service/wxService'\nimport { getSetting, getLoginFn, showToast,wxUserlLogin } from \"@/utils/index.js\";\nimport { errTips } from '@/api/error/errTips';\n\nexport const http = {\n    get: (url, config) => {\n        return requset(url, config, 'get');\n    },\n    post: (url, config) => {\n        return requset(url, config, 'post');\n    },\n\tpatch: (url, config) => {\n\t    return requset(url, config, 'patch');\n\t},\n}\n\nconst wxRequset = async(url, config, method) => {\n\tlet SERVICE =\"login\"\n\tif (url.startsWith('users')) {\n\t\tSERVICE =\"login\"\n\t} else {\n\t\tSERVICE =\"koa-0jh8\"\n\t}\n\n\treturn new Promise(async(resolve, reject) => {\n\t\tlet data =  await wx.cloud.callContainer({\n\t\t  \"config\": {\n\t\t\t\"env\": \"prod-8gqm1nbtf8eae76e\"\n\t\t  },\n\t\t  \"path\": url,\n\t\t  \"header\": {\n\t\t\t\"X-WX-SERVICE\": SERVICE,\n\t\t\t\"authorization\": uni.getStorageSync(\"token\")\n\t\t  },\n\t\t  \"method\": method,\n\t\t  \"data\": config\n\t\t})\n\t\tconst res = data.data\n\t\tif (res.code == 0) {\n\t\t    resolve(res)\n\t\t} else if (res.error == '10101') {\n\t\t\tshowToast('token已过期重新登录');\n\t\t    wxUserlLogin().then((res) => {\n\t\t\t\tconsole.log(\"res\", res);\n\t\t\t\tresolve(res)\n\t\t    },rej => {\n\t\t\t\treject(rej)\n\t\t\t})\n\t\t} else {\n\t\t    showToast(errTips[res.error] || res.message || '未知错误');\n\t\t\treject(res)\n\t\t}\n\t})\n}\nexport default async function requset(url, config = {}, method) {\n  const systemInfo = uni.getSystemInfoSync();\n\n  if (config && !config.hideLoading) {\n      uni.showLoading({\n          title: '加载中...'\n      });\n  }\n\n  try {\n      let res;\n      if (true) {\n\t\t// 微信云托管接口\n\t\treturn wxRequset(url, config, method);\n      } else {\n        return wxService(url, config, method);\n      }\n  } catch (err) {\n      console.error(err);\n      return Promise.reject(err); // 返回一个被拒绝的 Promise\n  } finally {\n      if (config && !config.hideLoading) {\n          uni.hideLoading();\n      }\n  }\n}\n\n\n\n"],"names":["wx","uni","showToast","wxUserlLogin","res","errTips"],"mappings":";;;;;AAIY,MAAC,OAAO;AAAA,EAChB,KAAK,CAAC,KAAK,WAAW;AAClB,WAAO,QAAQ,KAAK,QAAQ,KAAK;AAAA,EACpC;AAAA,EACD,MAAM,CAAC,KAAK,WAAW;AACnB,WAAO,QAAQ,KAAK,QAAQ,MAAM;AAAA,EACrC;AAAA,EACJ,OAAO,CAAC,KAAK,WAAW;AACpB,WAAO,QAAQ,KAAK,QAAQ,OAAO;AAAA,EACtC;AACF;AAEA,MAAM,YAAY,OAAM,KAAK,QAAQ,WAAW;AAC/C,MAAI,UAAS;AACb,MAAI,IAAI,WAAW,OAAO,GAAG;AAC5B,cAAS;AAAA,EACX,OAAQ;AACN,cAAS;AAAA,EACT;AAED,SAAO,IAAI,QAAQ,OAAM,SAAS,WAAW;AAC5C,QAAI,OAAQ,MAAMA,mBAAG,MAAM,cAAc;AAAA,MACvC,UAAU;AAAA,QACX,OAAO;AAAA,MACL;AAAA,MACD,QAAQ;AAAA,MACR,UAAU;AAAA,QACX,gBAAgB;AAAA,QAChB,iBAAiBC,cAAAA,MAAI,eAAe,OAAO;AAAA,MACzC;AAAA,MACD,UAAU;AAAA,MACV,QAAQ;AAAA,IACZ,CAAG;AACD,UAAM,MAAM,KAAK;AACjB,QAAI,IAAI,QAAQ,GAAG;AACf,cAAQ,GAAG;AAAA,IACjB,WAAa,IAAI,SAAS,SAAS;AAChCC,kBAAS,UAAC,cAAc;AACrBC,+BAAc,EAAC,KAAK,CAACC,SAAQ;AAC/BH,sBAAA,MAAA,MAAA,OAAA,sBAAY,OAAOG,IAAG;AACtB,gBAAQA,IAAG;AAAA,MACR,GAAC,SAAO;AACX,eAAO,GAAG;AAAA,MACd,CAAI;AAAA,IACJ,OAAS;AACHF,kBAAS,UAACG,kBAAO,QAAC,IAAI,KAAK,KAAK,IAAI,WAAW,MAAM;AACxD,aAAO,GAAG;AAAA,IACV;AAAA,EACH,CAAE;AACF;AACe,eAAe,QAAQ,KAAK,SAAS,CAAA,GAAI,QAAQ;AAC3CJ,gBAAAA,MAAI,kBAAoB;AAE3C,MAAI,UAAU,CAAC,OAAO,aAAa;AAC/BA,kBAAAA,MAAI,YAAY;AAAA,MACZ,OAAO;AAAA,IACjB,CAAO;AAAA,EACJ;AAED,MAAI;AACA,QAAI;AACJ,QAAI,MAAM;AAEd,aAAO,UAAU,KAAK,QAAQ,MAAM;AAAA,IAG/B;AAAA,EACJ,SAAQ,KAAK;AACVA,kBAAAA,2CAAc,GAAG;AACjB,WAAO,QAAQ,OAAO,GAAG;AAAA,EAC/B,UAAY;AACN,QAAI,UAAU,CAAC,OAAO,aAAa;AAC/BA,oBAAG,MAAC,YAAW;AAAA,IAClB;AAAA,EACJ;AACH;;"}