{"version":3,"file":"useImageSelect.js","sources":["hooks/useImageSelect.js"],"sourcesContent":["import { ref } from 'vue'\nimport { ImageUtils } from '../utils/imageUtils'\n\nexport function useImageSelect(canvasId) {\n  const imageInfo = ref(null)\n  const isProcessing = ref(false)\n\n  /**\n   * 选择图片\n   */\n  const selectImage = async (canvasSize) => {\n    if (isProcessing.value) return\n    \n    try {\n      isProcessing.value = true\n      \n      const res = await uni.chooseImage({\n        count: 1,\n        sizeType: ['original'], // 使用原图\n        sourceType: ['album', 'camera']\n      })\n\n      const imgInfo = await ImageUtils.getImageInfo(res.tempFilePaths[0])\n      const fitSize = ImageUtils.calculateFitSize(imgInfo, canvasSize)\n\n      // 绘制图片\n      const ctx = uni.createCanvasContext(canvasId)\n      ctx.clearRect(0, 0, canvasSize.width, canvasSize.height)\n      \n      // 设置高质量绘制\n      ctx.imageSmoothingEnabled = true\n      ctx.imageSmoothingQuality = 'high'\n\n      await new Promise((resolve) => {\n        ctx.drawImage(\n          res.tempFilePaths[0],\n          fitSize.x,\n          fitSize.y,\n          fitSize.width,\n          fitSize.height\n        )\n        ctx.draw(false, resolve)\n      })\n\n      // 更新图片信息\n      imageInfo.value = {\n        url: res.tempFilePaths[0],\n        ...fitSize\n      }\n\n      return imageInfo.value\n    } catch (error) {\n      uni.showToast({\n        title: '图片处理失败',\n        icon: 'none'\n      })\n      throw error\n    } finally {\n      isProcessing.value = false\n    }\n  }\n\n  return {\n    imageInfo,\n    isProcessing,\n    selectImage\n  }\n}\n"],"names":["ref","uni","ImageUtils"],"mappings":";;;AAGO,SAAS,eAAe,UAAU;AACvC,QAAM,YAAYA,cAAG,IAAC,IAAI;AAC1B,QAAM,eAAeA,cAAG,IAAC,KAAK;AAK9B,QAAM,cAAc,OAAO,eAAe;AACxC,QAAI,aAAa;AAAO;AAExB,QAAI;AACF,mBAAa,QAAQ;AAErB,YAAM,MAAM,MAAMC,cAAG,MAAC,YAAY;AAAA,QAChC,OAAO;AAAA,QACP,UAAU,CAAC,UAAU;AAAA;AAAA,QACrB,YAAY,CAAC,SAAS,QAAQ;AAAA,MACtC,CAAO;AAED,YAAM,UAAU,MAAMC,4BAAW,aAAa,IAAI,cAAc,CAAC,CAAC;AAClE,YAAM,UAAUA,iBAAU,WAAC,iBAAiB,SAAS,UAAU;AAG/D,YAAM,MAAMD,cAAAA,MAAI,oBAAoB,QAAQ;AAC5C,UAAI,UAAU,GAAG,GAAG,WAAW,OAAO,WAAW,MAAM;AAGvD,UAAI,wBAAwB;AAC5B,UAAI,wBAAwB;AAE5B,YAAM,IAAI,QAAQ,CAAC,YAAY;AAC7B,YAAI;AAAA,UACF,IAAI,cAAc,CAAC;AAAA,UACnB,QAAQ;AAAA,UACR,QAAQ;AAAA,UACR,QAAQ;AAAA,UACR,QAAQ;AAAA,QACT;AACD,YAAI,KAAK,OAAO,OAAO;AAAA,MAC/B,CAAO;AAGD,gBAAU,QAAQ;AAAA,QAChB,KAAK,IAAI,cAAc,CAAC;AAAA,QACxB,GAAG;AAAA,MACJ;AAED,aAAO,UAAU;AAAA,IAClB,SAAQ,OAAO;AACdA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,MACd,CAAO;AACD,YAAM;AAAA,IACZ,UAAc;AACR,mBAAa,QAAQ;AAAA,IACtB;AAAA,EACF;AAED,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,EACD;AACH;;"}