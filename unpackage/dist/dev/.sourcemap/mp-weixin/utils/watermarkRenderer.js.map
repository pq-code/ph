{"version":3,"file":"watermarkRenderer.js","sources":["utils/watermarkRenderer.js"],"sourcesContent":["import dayjs from 'dayjs'\n\nexport class WatermarkRenderer {\n  constructor(ctx) {\n    this.ctx = ctx\n  }\n\n  /**\n   * 渲染水印\n   */\n  async render(options) {\n    const { image, text, info } = options\n    \n    // 清除画布并绘制原图\n    await this.drawImage(image)\n    \n    // 绘制中心水印文字\n    this.drawCenterText(text, image)\n    \n    // 绘制信息水印\n    this.drawInfoText(info, image)\n    \n    // 完成绘制\n    this.ctx.draw(true)\n  }\n\n  /**\n   * 绘制原始图片\n   */\n  async drawImage(image) {\n    const { url, x, y, width, height } = image\n    this.ctx.clearRect(0, 0, width, height)\n    await this.ctx.drawImage(url, x, y, width, height)\n  }\n\n  /**\n   * 绘制中心水印文字\n   */\n  drawCenterText(text, image) {\n    const { width, height, x, y } = image\n    \n    this.ctx.save()\n    \n    // 计算字体大小和位置\n    const fontSize = Math.min(width, height) * 0.05\n    const centerX = x + width / 2\n    const centerY = y + height / 2\n    \n    // 设置文字样式\n    this.ctx.setFontSize(fontSize)\n    this.ctx.setTextAlign('center')\n    this.ctx.setTextBaseline('middle')\n    this.ctx.translate(centerX, centerY)\n    \n    // 绘制白色描边\n    this.ctx.setGlobalAlpha(1)\n    this.ctx.setLineWidth(2)\n    this.ctx.setStrokeStyle('#FFFFFF')\n    this.ctx.strokeText(text, 0, 0)\n    \n    // 绘制主体文字\n    this.ctx.setGlobalAlpha(1)\n    this.ctx.setFillStyle('#666666')\n    this.ctx.font = `normal ${fontSize}px sans-serif`\n    this.ctx.fillText(text, 0, 0)\n    \n    this.ctx.restore()\n  }\n\n  /**\n   * 绘制信息水印\n   */\n  drawInfoText(info, image) {\n    const { width, height, x, y } = image\n    \n    this.ctx.save()\n    \n    // 设置文字样式\n    const fontSize = 12\n    this.ctx.setFontSize(fontSize)\n    this.ctx.setTextAlign('left')\n    this.ctx.setTextBaseline('top')\n    this.ctx.setGlobalAlpha(1)\n    this.ctx.setFillStyle('#FFFFFF')\n    \n    // 准备水印文本\n    const lines = this.getWatermarkLines(info)\n    \n    // 计算位置并绘制\n    const padding = 15\n    const lineHeight = fontSize + 2\n    let currentY = height - (lines.length * lineHeight) - padding + y\n    \n    lines.forEach(line => {\n      this.ctx.setShadow(1, 1, 2, 'rgba(0, 0, 0, 0.5)')\n      this.ctx.fillText(line, padding + x, currentY)\n      currentY += lineHeight\n    })\n    \n    this.ctx.restore()\n  }\n\n  /**\n   * 获取水印文本行\n   */\n  getWatermarkLines(info) {\n    const timestamp = dayjs().format('YYYY-MM-DD HH:mm:ss')\n    return [\n      `经度：${info.longitude}`,\n      `纬度：${info.latitude}`,\n      `坐标：WGS84坐标系`,\n      `地址：${info.address}`,\n      `时间：${timestamp}`,\n      `备注：${info.notes || ''}`\n    ]\n  }\n} \n"],"names":["dayjs"],"mappings":";;AAEO,MAAM,kBAAkB;AAAA,EAC7B,YAAY,KAAK;AACf,SAAK,MAAM;AAAA,EACZ;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,OAAO,SAAS;AACpB,UAAM,EAAE,OAAO,MAAM,KAAM,IAAG;AAG9B,UAAM,KAAK,UAAU,KAAK;AAG1B,SAAK,eAAe,MAAM,KAAK;AAG/B,SAAK,aAAa,MAAM,KAAK;AAG7B,SAAK,IAAI,KAAK,IAAI;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA,EAKD,MAAM,UAAU,OAAO;AACrB,UAAM,EAAE,KAAK,GAAG,GAAG,OAAO,OAAM,IAAK;AACrC,SAAK,IAAI,UAAU,GAAG,GAAG,OAAO,MAAM;AACtC,UAAM,KAAK,IAAI,UAAU,KAAK,GAAG,GAAG,OAAO,MAAM;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA,EAKD,eAAe,MAAM,OAAO;AAC1B,UAAM,EAAE,OAAO,QAAQ,GAAG,EAAG,IAAG;AAEhC,SAAK,IAAI,KAAM;AAGf,UAAM,WAAW,KAAK,IAAI,OAAO,MAAM,IAAI;AAC3C,UAAM,UAAU,IAAI,QAAQ;AAC5B,UAAM,UAAU,IAAI,SAAS;AAG7B,SAAK,IAAI,YAAY,QAAQ;AAC7B,SAAK,IAAI,aAAa,QAAQ;AAC9B,SAAK,IAAI,gBAAgB,QAAQ;AACjC,SAAK,IAAI,UAAU,SAAS,OAAO;AAGnC,SAAK,IAAI,eAAe,CAAC;AACzB,SAAK,IAAI,aAAa,CAAC;AACvB,SAAK,IAAI,eAAe,SAAS;AACjC,SAAK,IAAI,WAAW,MAAM,GAAG,CAAC;AAG9B,SAAK,IAAI,eAAe,CAAC;AACzB,SAAK,IAAI,aAAa,SAAS;AAC/B,SAAK,IAAI,OAAO,UAAU,QAAQ;AAClC,SAAK,IAAI,SAAS,MAAM,GAAG,CAAC;AAE5B,SAAK,IAAI,QAAS;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA,EAKD,aAAa,MAAM,OAAO;AACxB,UAAM,EAAE,OAAO,QAAQ,GAAG,EAAG,IAAG;AAEhC,SAAK,IAAI,KAAM;AAGf,UAAM,WAAW;AACjB,SAAK,IAAI,YAAY,QAAQ;AAC7B,SAAK,IAAI,aAAa,MAAM;AAC5B,SAAK,IAAI,gBAAgB,KAAK;AAC9B,SAAK,IAAI,eAAe,CAAC;AACzB,SAAK,IAAI,aAAa,SAAS;AAG/B,UAAM,QAAQ,KAAK,kBAAkB,IAAI;AAGzC,UAAM,UAAU;AAChB,UAAM,aAAa,WAAW;AAC9B,QAAI,WAAW,SAAU,MAAM,SAAS,aAAc,UAAU;AAEhE,UAAM,QAAQ,UAAQ;AACpB,WAAK,IAAI,UAAU,GAAG,GAAG,GAAG,oBAAoB;AAChD,WAAK,IAAI,SAAS,MAAM,UAAU,GAAG,QAAQ;AAC7C,kBAAY;AAAA,IAClB,CAAK;AAED,SAAK,IAAI,QAAS;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA,EAKD,kBAAkB,MAAM;AACtB,UAAM,YAAYA,cAAAA,QAAQ,OAAO,qBAAqB;AACtD,WAAO;AAAA,MACL,MAAM,KAAK,SAAS;AAAA,MACpB,MAAM,KAAK,QAAQ;AAAA,MACnB;AAAA,MACA,MAAM,KAAK,OAAO;AAAA,MAClB,MAAM,SAAS;AAAA,MACf,MAAM,KAAK,SAAS,EAAE;AAAA,IACvB;AAAA,EACF;AACH;;"}