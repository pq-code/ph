{"version":3,"file":"index.js","sources":["utils/index.js"],"sourcesContent":["import {\r\n\tarmorTransformation,\r\n\tloginTg,\r\n\tgetUerInfo\r\n} from \"../api/apis/user\"\r\nimport {\r\n\thost\r\n} from \"@/config/index\";\r\n\r\n// 获取图片\r\nexport const imageUrl = (e) => {\r\n\treturn host + \"/image\" + e;\r\n}\r\n\r\nexport const showToast = (e) => {\r\n\tuni.showToast({\r\n\t\ticon: 'none',\r\n\t\tposition: 'center',\r\n\t\ttitle: e,\r\n\t});\r\n};\r\n\r\nexport const uploadImgs = (uploadUrl, filePath, successCallback, errorCallback) => {\r\n\r\n}\r\n\r\nexport const getSetting = (scope) => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tuni.authorize({\r\n\t\t\tscope,\r\n\t\t\tsuccess(data) {\r\n\t\t\t\tresolve(data);\r\n\t\t\t},\r\n\t\t\tfail(err) {\r\n\t\t\t\tconsole.log(err);\r\n\t\t\t\treject(err);\r\n\t\t\t},\r\n\t\t});\r\n\t})\r\n}\r\n\r\n// 登录\r\nexport const getLoginFn = async () => {\r\n\ttry {\r\n\t\tlet user = await getUerInfo() // 判断token是否过期没有过期不需要重新登录\r\n\t\tif (user.code == 0) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tresolve(user)\r\n\t\t\t});\r\n\t\t}\r\n\t} catch (err) {\r\n\t\treturn wxUserlLogin()\r\n\t}\r\n}\r\n\r\n\r\n// 登录\r\nexport const wxUserlLogin = async () => {\r\n\tconst login = () => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t//获取code\r\n\t\t\tuni.login({\r\n\t\t\t\tprovider: 'weixin',\r\n\t\t\t\tsearchFn: true,\r\n\t\t\t\tonlyAuthorize: true,\r\n\t\t\t\tsuccess(res) {\r\n\t\t\t\t\tresolve(res);\r\n\t\t\t\t},\r\n\t\t\t\tfail: (err) => {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\tconst getUserInfo = () => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t//获取用户信息\r\n\t\t\tuni.getUserInfo({\r\n\t\t\t\tprovider: 'weixin',\r\n\t\t\t\tdesc: '昵称、头像,用于个性化展示',\r\n\t\t\t\tlang: 'zh_CN',\r\n\t\t\t\ttimeout: 3000,\r\n\t\t\t\tsuccess(res) {\r\n\t\t\t\t\tresolve(res);\r\n\t\t\t\t},\r\n\t\t\t\tfail: (err) => {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\treturn new Promise(async(resolve, reject) => {\n\t\tlet res = await Promise.all([login()])\n\t\tconsole.log(res)\n\t\t// 连接本地后端接口\n\t\tlet data = {}\n\t\tif (res[0].code) {\n\t\t\ttry {\n\t\t\t\t// 登录\n\t\t\t\tdata = await armorTransformation({\n\t\t\t\t\tcode: res[0].code,\n\t\t\t\t\tuserInfo: res[1] || {}\n\t\t\t\t})\n\t\t\t\tif (data.code == 0) {\n\t\t\t\t\t// showToast('登录成功');\n\t\t\t\t\tconst {\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t\tuserId,\n\t\t\t\t\t\tuserName,\n\t\t\t\t\t\tuserPassword,\n\t\t\t\t\t\tuserSource,\n\t\t\t\t\t\tuserSourceID,\n\t\t\t\t\t\tuserNickname,\n\t\t\t\t\t\tuserInfo,\n\t\t\t\t\t\tuserProfilePhoto,\n\t\t\t\t\t\tsessionKey\n\t\t\t\t\t} = data.result\n\t\t\t\t\tuni.setStorageSync('token', token);\n\t\t\t\t\tuni.setStorageSync('userInfo', {\n\t\t\t\t\t\tuserId,\n\t\t\t\t\t\tuserName,\n\t\t\t\t\t\tuserPassword,\n\t\t\t\t\t\tuserSource,\n\t\t\t\t\t\tuserSourceID,\n\t\t\t\t\t\tuserNickname,\n\t\t\t\t\t\tuserInfo,\n\t\t\t\t\t\tuserProfilePhoto,\n\t\t\t\t\t\tsessionKey\n\t\t\t\t\t});\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\tresolve(data)\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error('登录失败:', err);\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\treject(data)\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('登录失败:', err);\n\t\t\t\tuni.hideLoading();\n\t\t\t\treject(data)\n\t\t\t}\n\t\t}\n\t})\r\n}"],"names":["uni","getUerInfo","err","armorTransformation"],"mappings":";;;AAcY,MAAC,YAAY,CAAC,MAAM;AAC/BA,gBAAAA,MAAI,UAAU;AAAA,IACb,MAAM;AAAA,IACN,UAAU;AAAA,IACV,OAAO;AAAA,EACT,CAAE;AACF;AAsBY,MAAC,aAAa,YAAY;AACrC,MAAI;AACH,QAAI,OAAO,MAAMC,yBAAY;AAC7B,QAAI,KAAK,QAAQ,GAAG;AACnB,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvC,gBAAQ,IAAI;AAAA,MAChB,CAAI;AAAA,IACD;AAAA,EACD,SAAQC,MAAK;AACb,WAAO,aAAc;AAAA,EACrB;AACF;AAIY,MAAC,eAAe,YAAY;AACvC,QAAM,QAAQ,MAAM;AACnB,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAEvCF,oBAAAA,MAAI,MAAM;AAAA,QACT,UAAU;AAAA,QACV,UAAU;AAAA,QACV,eAAe;AAAA,QACf,QAAQ,KAAK;AACZ,kBAAQ,GAAG;AAAA,QACX;AAAA,QACD,MAAM,CAACE,SAAQ;AACd,iBAAOA,IAAG;AAAA,QACV;AAAA,MACL,CAAI;AAAA,IACJ,CAAG;AAAA,EACH;AAkBC,SAAO,IAAI,QAAQ,OAAM,SAAS,WAAW;AAC5C,QAAI,MAAM,MAAM,QAAQ,IAAI,CAAC,MAAO,CAAA,CAAC;AACrCF,kBAAAA,MAAA,MAAA,OAAA,wBAAY,GAAG;AAEf,QAAI,OAAO,CAAE;AACb,QAAI,IAAI,CAAC,EAAE,MAAM;AAChB,UAAI;AAEH,eAAO,MAAMG,cAAAA,oBAAoB;AAAA,UAChC,MAAM,IAAI,CAAC,EAAE;AAAA,UACb,UAAU,IAAI,CAAC,KAAK,CAAE;AAAA,QAC3B,CAAK;AACD,YAAI,KAAK,QAAQ,GAAG;AAEnB,gBAAM;AAAA,YACL;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACA,IAAG,KAAK;AACTH,wBAAAA,MAAI,eAAe,SAAS,KAAK;AACjCA,wBAAG,MAAC,eAAe,YAAY;AAAA,YAC9B;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACN,CAAM;AACDA,wBAAG,MAAC,YAAW;AACf,kBAAQ,IAAI;AAAA,QACjB,OAAW;AACNA,wBAAc,MAAA,MAAA,SAAA,yBAAA,SAAS,GAAG;AAC1BA,wBAAG,MAAC,YAAW;AACf,iBAAO,IAAI;AAAA,QACX;AAAA,MACD,SAAQE,MAAK;AACbF,sBAAc,MAAA,MAAA,SAAA,yBAAA,SAASE,IAAG;AAC1BF,sBAAG,MAAC,YAAW;AACf,eAAO,IAAI;AAAA,MACX;AAAA,IACD;AAAA,EACH,CAAE;AACF;;;;"}