{"version":3,"file":"useImageHandler.js","sources":["pages/home/ph/addWatermark/hooks/useImageHandler.js"],"sourcesContent":["import { ref } from 'vue'\n\nexport const useImageHandler = () => {\n  const imageInfo = ref(null)\n  const originalImage = ref(null)\n  const isProcessing = ref(false)\n\n  // 计算图片在容器中的绘制尺寸\n  const calculateDrawSize = (containerWidth, containerHeight, imageWidth, imageHeight) => {\n    const containerRatio = containerWidth / containerHeight\n    const imageRatio = imageWidth / imageHeight\n    let drawWidth, drawHeight, x, y\n\n    if (imageRatio > containerRatio) {\n      // 图片较宽，以容器宽度为准\n      drawWidth = containerWidth\n      drawHeight = containerWidth / imageRatio\n      x = 0\n      y = (containerHeight - drawHeight) / 2\n    } else {\n      // 图片较高，以容器高度为准\n      drawHeight = containerHeight\n      drawWidth = containerHeight * imageRatio\n      x = (containerWidth - drawWidth) / 2\n      y = 0\n    }\n\n    return { drawWidth, drawHeight, x, y }\n  }\n\n  const handleImageSelect = async () => {\n    try {\n      isProcessing.value = true\n      \n      // 选择图片\n      const { tempFiles } = await uni.chooseImage({\n        count: 1,\n        sizeType: [\"original\"],\n        sourceType: [\"album\"],\n      })\n\n      const tempFile = tempFiles[0]\n      \n      // 获取容器尺寸\n      const container = await new Promise(resolve => {\n        const query = uni.createSelectorQuery()\n        query.select('.content-main')\n          .boundingClientRect(data => {\n            resolve(data)\n          }).exec()\n      })\n\n      // 获取图片信息\n      const imgInfo = await new Promise((resolve, reject) => {\n        uni.getImageInfo({\n          src: tempFile.path,\n          success: resolve,\n          fail: reject\n        })\n      })\n\n      // 计算绘制尺寸\n      const { drawWidth, drawHeight, x, y } = calculateDrawSize(\n        container.width,\n        container.height,\n        imgInfo.width,\n        imgInfo.height\n      )\n\n      // 保存图片信息\n      originalImage.value = tempFile\n      imageInfo.value = {\n        path: tempFile.path,\n        width: imgInfo.width,\n        height: imgInfo.height,\n        x,\n        y,\n        drawWidth,\n        drawHeight,\n        canvasWidth: container.width,\n        canvasHeight: container.height\n      }\n\n      console.log('图片信息:', imageInfo.value)\n      return imageInfo.value\n      \n    } catch (error) {\n      console.error('选择图片失败:', error)\n      uni.showToast({\n        title: '选择图片失败',\n        icon: 'none'\n      })\n    } finally {\n      isProcessing.value = false\n    }\n  }\n\n  return {\n    imageInfo,\n    isProcessing,\n    handleImageSelect\n  }\n}\n"],"names":["ref","uni"],"mappings":";;AAEY,MAAC,kBAAkB,MAAM;AACnC,QAAM,YAAYA,cAAG,IAAC,IAAI;AAC1B,QAAM,gBAAgBA,cAAG,IAAC,IAAI;AAC9B,QAAM,eAAeA,cAAG,IAAC,KAAK;AAG9B,QAAM,oBAAoB,CAAC,gBAAgB,iBAAiB,YAAY,gBAAgB;AACtF,UAAM,iBAAiB,iBAAiB;AACxC,UAAM,aAAa,aAAa;AAChC,QAAI,WAAW,YAAY,GAAG;AAE9B,QAAI,aAAa,gBAAgB;AAE/B,kBAAY;AACZ,mBAAa,iBAAiB;AAC9B,UAAI;AACJ,WAAK,kBAAkB,cAAc;AAAA,IAC3C,OAAW;AAEL,mBAAa;AACb,kBAAY,kBAAkB;AAC9B,WAAK,iBAAiB,aAAa;AACnC,UAAI;AAAA,IACL;AAED,WAAO,EAAE,WAAW,YAAY,GAAG,EAAG;AAAA,EACvC;AAED,QAAM,oBAAoB,YAAY;AACpC,QAAI;AACF,mBAAa,QAAQ;AAGrB,YAAM,EAAE,UAAS,IAAK,MAAMC,cAAAA,MAAI,YAAY;AAAA,QAC1C,OAAO;AAAA,QACP,UAAU,CAAC,UAAU;AAAA,QACrB,YAAY,CAAC,OAAO;AAAA,MAC5B,CAAO;AAED,YAAM,WAAW,UAAU,CAAC;AAG5B,YAAM,YAAY,MAAM,IAAI,QAAQ,aAAW;AAC7C,cAAM,QAAQA,cAAG,MAAC,oBAAqB;AACvC,cAAM,OAAO,eAAe,EACzB,mBAAmB,UAAQ;AAC1B,kBAAQ,IAAI;AAAA,QACb,CAAA,EAAE,KAAM;AAAA,MACnB,CAAO;AAGD,YAAM,UAAU,MAAM,IAAI,QAAQ,CAAC,SAAS,WAAW;AACrDA,sBAAAA,MAAI,aAAa;AAAA,UACf,KAAK,SAAS;AAAA,UACd,SAAS;AAAA,UACT,MAAM;AAAA,QAChB,CAAS;AAAA,MACT,CAAO;AAGD,YAAM,EAAE,WAAW,YAAY,GAAG,EAAG,IAAG;AAAA,QACtC,UAAU;AAAA,QACV,UAAU;AAAA,QACV,QAAQ;AAAA,QACR,QAAQ;AAAA,MACT;AAGD,oBAAc,QAAQ;AACtB,gBAAU,QAAQ;AAAA,QAChB,MAAM,SAAS;AAAA,QACf,OAAO,QAAQ;AAAA,QACf,QAAQ,QAAQ;AAAA,QAChB;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,aAAa,UAAU;AAAA,QACvB,cAAc,UAAU;AAAA,MACzB;AAEDA,oBAAA,MAAA,MAAA,OAAA,6DAAY,SAAS,UAAU,KAAK;AACpC,aAAO,UAAU;AAAA,IAElB,SAAQ,OAAO;AACdA,oBAAAA,MAAc,MAAA,SAAA,6DAAA,WAAW,KAAK;AAC9BA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,MACd,CAAO;AAAA,IACP,UAAc;AACR,mBAAa,QAAQ;AAAA,IACtB;AAAA,EACF;AAED,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,EACD;AACH;;"}