{"version":3,"file":"addWatermark.js","sources":["pages/home/ph/addWatermark/addWatermark.vue","pages/home/ph/addWatermark/addWatermark.vue?type=page"],"sourcesContent":["<script setup>\r\nimport page from \"@/components/pages/page.vue\";\r\nimport { ref } from 'vue'\r\nimport { useImageHandler } from './hooks/useImageHandler'\r\nimport { useWatermark } from './hooks/useWatermark'\r\nimport { useWatermarkForm } from './hooks/useWatermarkForm'\r\nimport { WATERMARK_TYPES } from './constants/watermarkConfig'\r\nimport WatermarkTypeSelector from './components/WatermarkTypeSelector.vue'\r\nimport WatermarkForm from './components/WatermarkForm.vue'\r\n\r\nconst watermarkType = ref(1)\r\nconst currentStyle = ref(WATERMARK_TYPES[0].style)\r\n\r\nconst { imageInfo, isProcessing, handleImageSelect } = useImageHandler()\r\nconst { addWatermark } = useWatermark('watermark')\r\nconst { formData, getFormFields, validateForm, resetForm } = useWatermarkForm()\r\n\r\n// 处理水印类型变化\r\nconst handleTypeChange = (style) => {\r\n  currentStyle.value = style\r\n  if (imageInfo.value) {\r\n    updateWatermark()\r\n  }\r\n}\r\n\r\n// 更新水印\r\nconst updateWatermark = async () => {\r\n  if (!imageInfo.value || !currentStyle.value) return\r\n  await addWatermark({\r\n    image: imageInfo.value,\r\n    style: currentStyle.value,\r\n    info: formData.value\r\n  })\r\n}\r\n\r\n// 处理图片选择\r\nconst onImageSelect = async () => {\r\n  if (isProcessing.value) return\r\n  const image = await handleImageSelect()\r\n  if (image) {\r\n    await updateWatermark() // 更新水印\r\n  }\r\n}\r\n// 生成最终图片\r\nconst generateImage = async () => {\r\n  if (!imageInfo.value) {\r\n    uni.showToast({\r\n      title: '请先选择图片',\r\n      icon: 'none'\r\n    })\r\n    return\r\n  }\r\n}\r\n</script>\r\n\r\n<template>\r\n  <page \r\n    title=\"添加水印\" \r\n    rButton=\"生成图片\" \r\n    :rButtonDisabled=\"isProcessing\"\r\n    @rButton=\"generateImage\"\r\n  >\r\n    <view class=\"content\">\r\n     \r\n      <!-- 画布区域 -->\r\n      <view \r\n        id=\"contentMain\" \r\n        class=\"content-main\"\r\n        @click=\"onImageSelect\"\r\n      >\r\n        <canvas \r\n          canvas-id=\"watermark\"\r\n          class=\"watermark-canvas\"\r\n          :style=\"{\r\n            width: imageInfo?.canvasWidth + 'px',\r\n            height: imageInfo?.canvasHeight + 'px'\r\n          }\"\r\n        />\r\n        <view v-if=\"!imageInfo\" class=\"placeholder\">\r\n          <u-icon name=\"camera-fill\" size=\"40\" color=\"#999\"/>\r\n          <text class=\"placeholder-text\">点击选择图片</text>\r\n        </view>\r\n      </view>\r\n      \r\n\t\t\t <!-- 水印类型选择器 -->\r\n\t\t\t <WatermarkTypeSelector\r\n        v-model=\"watermarkType\"\r\n        @change=\"handleTypeChange\"\r\n      />\r\n      \r\n      <!-- 表单区域 -->\r\n      <WatermarkForm\r\n        v-if=\"currentStyle\"\r\n        v-model=\"formData\"\r\n        :fields=\"getFormFields(currentStyle)\"\r\n        :disabled=\"isProcessing\"\r\n        @change=\"updateWatermark\"\r\n      />\r\n    </view>\r\n  </page>\r\n</template>\r\n\r\n<style lang=\"less\" scoped>\r\n.content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 15px;\r\n  padding: 10px;\r\n  background: #e6e6e6;\r\n\r\n  .content-main {\r\n    position: relative;\r\n    width: 100%;\r\n    height: 600px;\r\n    background: #ffffff;\r\n    border-radius: 8px;\r\n    overflow: hidden;\r\n    \r\n    .watermark-canvas {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n    \r\n    .placeholder {\r\n      position: absolute;\r\n      top: 50%;\r\n      left: 50%;\r\n      transform: translate(-50%, -50%);\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n      gap: 10px;\r\n      \r\n      .placeholder-text {\r\n        font-size: 14px;\r\n        color: #999;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style> \r\n","import MiniProgramPage from '/Users/pq/code/ph/pages/home/ph/addWatermark/addWatermark.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","WATERMARK_TYPES","useImageHandler","useWatermark","useWatermarkForm","uni"],"mappings":";;;;;;;;;;;;;;AACA,MAAM,OAAO,MAAW;AAMxB,MAAM,wBAAwB,MAAW;AACzC,MAAM,gBAAgB,MAAW;;;;AAEjC,UAAM,gBAAgBA,cAAG,IAAC,CAAC;AAC3B,UAAM,eAAeA,cAAAA,IAAIC,qDAAAA,gBAAgB,CAAC,EAAE,KAAK;AAEjD,UAAM,EAAE,WAAW,cAAc,kBAAiB,IAAKC,iDAAAA,gBAAiB;AACxE,UAAM,EAAE,aAAY,IAAKC,8CAAY,aAAC,WAAW;AACjD,UAAM,EAAE,UAAU,eAAe,cAAc,UAAS,IAAKC,kDAAAA,iBAAkB;AAG/E,UAAM,mBAAmB,CAAC,UAAU;AAClC,mBAAa,QAAQ;AACrB,UAAI,UAAU,OAAO;AACnB,wBAAiB;AAAA,MAClB;AAAA,IACH;AAGA,UAAM,kBAAkB,YAAY;AAClC,UAAI,CAAC,UAAU,SAAS,CAAC,aAAa;AAAO;AAC7C,YAAM,aAAa;AAAA,QACjB,OAAO,UAAU;AAAA,QACjB,OAAO,aAAa;AAAA,QACpB,MAAM,SAAS;AAAA,MACnB,CAAG;AAAA,IACH;AAGA,UAAM,gBAAgB,YAAY;AAChC,UAAI,aAAa;AAAO;AACxB,YAAM,QAAQ,MAAM,kBAAmB;AACvC,UAAI,OAAO;AACT,cAAM,gBAAiB;AAAA,MACxB;AAAA,IACH;AAEA,UAAM,gBAAgB,YAAY;AAChC,UAAI,CAAC,UAAU,OAAO;AACpBC,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD;AAAA,MACD;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnDA,GAAG,WAAW,eAAe;"}