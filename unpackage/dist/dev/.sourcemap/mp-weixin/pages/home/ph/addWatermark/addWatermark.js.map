{"version":3,"file":"addWatermark.js","sources":["pages/home/ph/addWatermark/addWatermark.vue","pages/home/ph/addWatermark/addWatermark.vue?type=page"],"sourcesContent":["<script setup>\r\n\timport {\r\n\t\tnextTick,\r\n\t\tonMounted,\r\n\t\tref,\r\n\t\treactive,\r\n\t\twatch,\r\n\t\tcomputed\r\n\t} from \"vue\";\r\n\timport {\r\n\t\tonLoad,\r\n\t\tonPullDownRefresh,\r\n\t\tonShow\r\n\t} from \"@dcloudio/uni-app\";\r\n\timport dayjs from \"dayjs\";\r\n\timport imageCropper from \"@/pages/home/components/imageCropper/imageCropper.vue\";\r\n\timport page from \"@/components/pages/page.vue\";\r\n\timport {\r\n\t\tgetCurrentInstance\r\n\t} from \"vue\";\r\n\tconst instance = getCurrentInstance();\r\n\r\n\tconst imageurl = ref({\r\n\t\turl: '',\r\n\t\tstatus: \"success\",\r\n\t\tmessage: 0,\r\n\t})// 图片信息\r\n\tconst originalImage = ref({\r\n\t\turl: '',\r\n\t\tstatus: \"success\",\r\n\t\tmessage: 0,\r\n\t})// 原始图片信息\r\nconst formData = ref({\r\n\t\tlongitude: '', //经度\r\n\tlatitude: '', // 纬度\r\n\taddress: '', // 地址\r\n\t\tnotes:'', // 备注\r\n\t\ttest: '',\r\n\t\timage: '',\r\n\t\topacity: '',\r\n\t\tangle: -45, // 角度\r\n\t\tdensity: '' // 密度\r\n\t})\r\n\tconst previewMain = ref({\r\n\t\twidth: '',\r\n\t\theight: ''\r\n\t})\r\n\r\n\t// 水印类型\r\n\tconst watermarkType = 1; // 1:现场拍照水印，2：图片水印\r\n\r\n\t// 清空画布\r\n\tconst clearCanvas = () => {\r\n\t\tconst ctx = uni.createCanvasContext(\"watermark\");\r\n\t\tctx.clearRect(0, 0, previewMain.value.width, previewMain.value.height); // 清空整个画布\r\n\t\tctx.draw();\r\n\t};\r\n\r\n\tonLoad(() => {\r\n\t\tediteImage.value = true\r\n\t\tnextTick(() => {\r\n\t\t\tediteImage.value = false\r\n\t\t})\r\n\t})\r\n\r\n\tonMounted(() => {\r\n\t\t// 创建查询对象\r\n\t\tconst query = uni.createSelectorQuery().in(instance.proxy);\r\n\r\n\t\t// 选择元素\r\n\t\tquery\r\n\t\t\t.select(\"#contentMain\")\r\n\t\t\t.boundingClientRect((data) => {\r\n\t\t\t\tif (data) {\r\n\t\t\t\t\t// data包含元素的宽高等信息\r\n\t\t\t\t\tconsole.log(\"元素的宽：\" + data.width);\r\n\t\t\t\t\tconsole.log(\"元素的高：\" + data.height);\r\n\t\t\t\t\tpreviewMain.value = {\r\n\t\t\t\t\t\twidth: data.width,\r\n\t\t\t\t\t\theight: data.height,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.exec(); // 执行查询\r\n\t});\r\n\r\n\tconst previewImage = (urls) => {\r\n\t\tuni.previewImage({\r\n\t\t\turls: [urls],\r\n\t\t\tcurrent: 1,\r\n\t\t\tlongPressActions: {\r\n\t\t\t\titemList: [\"发送给朋友\", \"保存图片\", \"收藏\"],\r\n\t\t\t\tsuccess: function(data) {},\r\n\t\t\t\tfail: function(err) {\r\n\t\t\t\t\tconsole.log(err.errMsg);\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '预览失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\tconst getImageInfo = (src) => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tuni.getImageInfo({\r\n\t\t\t\tsrc,\r\n\t\t\t\tsuccess: resolve,\r\n\t\t\t\tfail: reject\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\t// 添加图片\r\n\tconst chooseImage = () => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tuni.chooseImage({\r\n\t\t\tcount: 1,\r\n\t\t\tsizeType: [\"original\", \"compressed\"],\r\n\t\t\tsourceType: [\"album\"],\r\n\t\t\tsuccess: async function(res) {\r\n\t\t\t\tclearCanvas() // 重新绘制\r\n\t\t\t\tconst width = previewMain.value.width;\r\n\t\t\t\tconst height = previewMain.value.height;\r\n\t\t\t\tconst proportion = width / height;\r\n\r\n\t\t\t\t// 获取图片宽高做裁切\r\n\t\t\t\tconst imageInfo = await getImageInfo(res.tempFilePaths[0]);\r\n\t\t\t\t\r\n\t\t\t\tlet imageW = imageInfo.width;\r\n\t\t\t\tlet imageH = imageInfo.height;\r\n\r\n\t\t\t\t// 保留原始图片信息\r\n\t\t\t\toriginalImage.value.url = {\r\n\t\t\t\t\turl: imageInfo.path,\r\n\t\t\t\t\twidth: imageW,\r\n\t\t\t\t\theight: imageH,\r\n\t\t\t\t\tstatus: \"success\",\r\n\t\t\t\t\tmessage: 0,\r\n\t\t\t\t};\r\n\t\t\t\t\r\n\t\t\t\t// 计算缩放比例，确保图片在保持宽高比的前提下，缩放到画布的最大尺寸\r\n\t\t\t\tlet scale = 1;\r\n\r\n\t\t\t\tif (imageW > imageH) {\r\n\t\t\t\t\t// 图片宽度大于高度，按高度缩放\r\n\t\t\t\t\tscale = imageW / width;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// 图片高度大于宽度，按宽度缩放\r\n\t\t\t\t\tscale = imageH / height;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 缩放后的图片宽度和高度\r\n\t\t\t\timageW /= scale;\r\n\t\t\t\timageH /= scale;\r\n\r\n\t\t\t\t// 计算绘制位置，确保图片在 Canvas 中居中显示\r\n\t\t\t\tlet drawX = (width - imageW) / 2;\r\n\t\t\t\tlet drawY = (height - imageH) / 2;\r\n\r\n\t\t\t\t// 绘制图片到 Canvas\r\n\t\t\t\tconst ctx = uni.createCanvasContext(\"watermark\");\r\n\t\t\t\t// 禁用图像平滑处理以保持清晰度\r\n\t\t\t\tctx.imageSmoothingEnabled = false;\r\n\t\t\t\tawait ctx.drawImage(imageInfo.path, drawX, drawY, imageW, imageH);\r\n\t\t\t\tawait ctx.draw(true);\r\n\t\t\t\t// const cropImage = (await uni.canvasToTempFilePath({ canvasId: \"watermark\" })).tempFilePath;\r\n\r\n\t\t\t\timageurl.value = {\r\n\t\t\t\t\turl: imageInfo.path,\r\n\t\t\t\t\twidth: imageW,\r\n\t\t\t\t\theight: imageH,\r\n\t\t\t\t\tx: drawX,\r\n\t\t\t\t\ty: drawY,\r\n\t\t\t\t\tstatus: \"success\",\r\n\t\t\t\t\tmessage: 0,\r\n\t\t\t\t};\r\n\t\t\t\tediteImage.value = false\r\n\t\t\t\tresolve();\r\n\t\t\t},\r\n\t\t\tfail: function(err) {\r\n\t\t\t\tconsole.log(err.errMsg);\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '选择图片失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\treject();\r\n\t\t\t},\r\n\t\t});\r\n\t\t});\r\n\t}\r\n\t// 添加水印\r\n\tconst addWatermark = async () => {\r\n  const { width: imageWidth, height: imageHeight, x: imageX, y: imageY, url } = imageurl.value;\r\n  const ctx = uni.createCanvasContext('watermark');\r\n  \r\n  // 清除并重绘原图\r\n  clearCanvas()\r\n  await ctx.drawImage(url, imageX, imageY, imageWidth, imageHeight);\r\n  \r\n  // 设置文字样式\r\n\tctx.save();\r\n\r\n  // 1. 绘制中间的大号水印文字\r\n  const centerText = \"现场拍照\";\r\n  const centerFontSize = Math.min(imageWidth, imageHeight) * 0.15; // 自适应字体大小\r\n  ctx.setFontSize(centerFontSize);\r\n  ctx.setTextAlign('center');\r\n  ctx.setTextBaseline('middle');\r\n  \r\n  // 计算中心点位置\r\n  const centerX = imageX + imageWidth / 2;\r\n  const centerY = imageY + imageHeight / 2;\r\n  \r\n  // 设置文字样式\r\n  ctx.translate(centerX, centerY);\r\n  \r\n  // 先绘制白色描边\r\n  ctx.setGlobalAlpha(0.2); // 描边透明度\r\n  ctx.setLineWidth(3); // 描边宽度\r\n  ctx.setStrokeStyle('#FFFFFF');\r\n  ctx.strokeText(centerText, 0, 0);\r\n  \r\n  // 再绘制主体文字\r\n  ctx.setGlobalAlpha(0.2); // 主体文字透明度\r\n  ctx.setFillStyle('#666666'); // 使用浅灰色\r\n  ctx.font = `bold ${centerFontSize}px sans-serif`;\r\n  ctx.fillText(centerText, 0, 0);\r\n  \r\n  ctx.restore();\r\n\t\r\n  const fontSize = 14; // 设置较小的字号\r\n  ctx.setFontSize(fontSize);\r\n  ctx.setTextAlign('left');\r\n  ctx.setTextBaseline('top');\r\n  \r\n  // 设置文字颜色和透明度\r\n  ctx.setGlobalAlpha(0.5); // 半透明效果\r\n  ctx.setFillStyle('#666666'); // 灰色文字\r\n  \r\n  // 准备水印文字内容\r\n  const timestamp = dayjs().format('YYYY-MM-DD HH:mm:ss');\r\n  const watermarkLines = [\r\n    `经度：${formData.value.longitude}`,\r\n    `纬度：${formData.value.latitude}`,\r\n    `坐标：WGS84坐标系`,\r\n    `地址：${formData.value.address}`,\r\n    `时间：${timestamp}`,\r\n    `备注：${formData.value.notes}`\r\n  ];\r\n  \r\n  // 计算文字位置\r\n  const padding = 20;\r\n  const lineHeight = fontSize + 4;\r\n  let currentY = imageHeight - (watermarkLines.length * lineHeight) - padding + imageY;\r\n\r\n  // 绘制每行文字\r\n  watermarkLines.forEach((line, index) => {\r\n    // 绘制主体文字\r\n    ctx.setGlobalAlpha(1);\r\n    ctx.setFillStyle('#FFFFFF');\r\n    ctx.fillText(line, padding + imageX, currentY);\r\n    currentY += lineHeight;\r\n  });\r\n\r\n  ctx.restore();\r\n  ctx.draw(true);\r\n}\r\n\r\n\tconst editeImage = ref(false)\r\n\tconst iamgeColumns = reactive([\r\n\t\t[{\r\n\t\t\t\tlabel: \"添加图片/编辑图片\",\r\n\t\t\t\tvalue: 1,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tlabel: \"拍照\",\r\n\t\t\t\tvalue: 2,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tlabel: \"预览图片\",\r\n\t\t\t\tvalue: 3,\r\n\t\t\t},\r\n\t\t]\r\n\t])\r\n\tconst editImagePicker = async(item) => {\r\n\t\tif (item.value[0].value == 1) {\r\n\t\t\tawait chooseImage(); // 添加图片\r\n\t\t\t// 添加水印\r\n\t\t\taddWatermark()\r\n\t\t} else if(item.value[0].value == 2) {\r\n\t\t\tuni.getSetting({\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tif (res.authSetting['scope.camera']) {\r\n\t\t\t\t\t\t// 用户已经授权\r\n\t\t\t\t\t\ttakePictures()\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// 用户还没有授权，向用户发起授权请求\r\n\t\t\t\t\t\tuni.authorize({\r\n\t\t\t\t\t\t\tscope: 'scope.camera',\r\n\t\t\t\t\t\t\tsuccess() {\r\n\t\t\t\t\t\t\t\t// 用户同意授权\r\n\t\t\t\t\t\t\t\ttakePictures()\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail() {\r\n\t\t\t\t\t\t\t\t// 用户不同意授权\r\n\t\t\t\t\t\t\t\t_this.openSetting('camera').then(res => {\r\n\t\t\t\t\t\t\t\t\ttakePictures()\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tfail: res => {\r\n\t\t\t\t\tconsole.log('获取用户授权信息失败');\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tpreviewImage(imageurl.value.url);\r\n\t\t}\r\n\t}\r\n\tconst takePictures = () => {\r\n\t\tuni.chooseImage({\r\n\t\t        count: 1, // 只能拍一张\r\n\t\t        sourceType: ['camera'], // 只允许拍照\r\n\t\t        success: (res) => {\r\n\t\t          // 获取拍照后的临时路径\r\n\t\t          this.imagePath = res.tempFilePaths[0];\r\n\t\t          console.log('拍照成功，图片路径：', this.imagePath);\r\n\t\t\r\n\t\t          // 这里可以进一步处理图片，比如上传到服务器\r\n\t\t          this.uploadImage(this.imagePath);\r\n\t\t        },\r\n\t\t        fail: (err) => {\r\n\t\t          console.error('拍照失败：', err);\r\n\t\t          uni.showToast({\r\n\t\t            title: '拍照失败，请重试',\r\n\t\t            icon: 'none'\r\n\t\t          });\r\n\t\t        }\r\n\t\t      });\r\n}\r\n\r\n\t\r\n// 生成图片\r\nconst generateImages = () => {\r\n  // 获取图片实际显示区域的尺寸和位置\r\n  const { width: imageWidth, height: imageHeight, x: imageX, y: imageY } = imageurl.value\r\n  \r\n  uni.canvasToTempFilePath({\r\n    canvasId: \"watermark\",\r\n    x: imageX, // 裁剪起点x坐标\r\n    y: imageY, // 裁剪起点y坐标\r\n    width: imageWidth, // 裁剪宽度\r\n    height: imageHeight, // 裁剪高度\r\n    destWidth: imageWidth, // 输出图片宽度\r\n    destHeight: imageHeight, // 输出图片高度\r\n    success: (res) => {\r\n      const tempFilePath = res.tempFilePath\r\n      // 预览生成的图片\r\n      uni.previewImage({\r\n        current: tempFilePath,\r\n        urls: [tempFilePath],\r\n        success: () => {\r\n          // 可以在这里添加保存成功的提示\r\n          uni.showToast({\r\n            title: '图片生成成功',\r\n            icon: 'success'\r\n          })\r\n        },\r\n        fail: () => {\r\n          uni.showToast({\r\n            title: '预览失败',\r\n            icon: 'none'\r\n          })\r\n        },\r\n      })\r\n    },\r\n    fail: (err) => {\r\n      console.error(\"生成图片失败:\", err)\r\n      uni.showToast({\r\n        title: \"生成图片失败\",\r\n        icon: \"none\",\r\n      })\r\n    },\r\n  })\r\n}\r\n\r\n\r\n\tconst selsectImageFn = () => {\r\n\t\tif (formData.value.image) {\r\n\t\t\tuni.previewImage({\r\n\t\t\t\turls: [formData.value.image],\r\n\t\t\t\tcurrent: 0,\r\n\t\t\t\tlongPressActions: {\r\n\t\t\t\t\titemList: [\"发送给朋友\", \"保存图片\", \"收藏\"],\r\n\t\t\t\t\tsuccess: function(data) {},\r\n\t\t\t\t\tfail: function(err) {\r\n\t\t\t\t\t\tconsole.log(err.errMsg);\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tuni.chooseImage({\r\n\t\t\t\tcount: 1, //默认9\r\n\t\t\t\tsizeType: [\"original\"], //可以指定是原图还是压缩图，默认二者都有\r\n\t\t\t\tsourceType: [\"album\"], //从相册选择\r\n\t\t\t\tsuccess: async function(res) {\r\n\t\t\t\t\tconst hw = await getImageInfo(res.tempFilePaths[0])\r\n\t\t\t\t\tformData.value.image = {\r\n\t\t\t\t\t\turl: res.tempFilePaths[0],\r\n\t\t\t\t\t\twidth: hw.width,\r\n\t\t\t\t\t\theight: hw.height,\r\n\t\t\t\t\t\tstatus: \"success\",\r\n\t\t\t\t\t}\r\n\t\t\t\t\taddWatermark() // 添加水印\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t// 生成水印\r\n\tconst generateWatermark = (item, image) => {\r\n\r\n\t}\r\n</script>\r\n\r\n<template>\r\n\t<u-picker :show=\"editeImage\" :columns=\"iamgeColumns\" keyName=\"label\" @cancel=\"editeImage = false\"\r\n\t\t@confirm=\"editImagePicker\" :closeOnClickOverlay='true'></u-picker>\r\n\t<page title=\"添加水印\" rButton=\"生成图片\" @rButton=\"generateImages\">\r\n\t\t<view class=\"content\">\r\n\t\t\t<view class=\"content-main\" id='contentMain'>\r\n\t\t\t\t<view class=\"watermark-canvas\" @click=\"editeImage= true\">\r\n\t\t\t\t\t<canvas canvas-id=\"watermark\" style=\"position: absolute;top: 0; z-index: 100;\"\r\n\t\t\t\t\t\t:style=\"{ width: previewMain.width +'px', height: previewMain.height +'px'}\"></canvas>\r\n\t\t\t\t</view>\r\n\t\t\t\t<!-- <view class=\"watermark-canvas-image\">\r\n\t\t\t\t\t<canvas canvas-id=\"watermarkImage\"\r\n\t\t\t\t\t\t:style=\"{ width: previewMain.width +'px', height: previewMain.height +'px'}\"></canvas>\r\n\t\t\t\t</view> -->\r\n\t\t\t</view>\r\n\r\n\t\t\t<view class=\"controlPanel\">\r\n\t\t\t\t<u-form labelWidth=\"100px\" labelPosition=\"left\" labelAlign=\"left\" :model=\"formData\" ref=\"form1\">\r\n\t\t\t\t\t<!-- <u-form-item label=\"水印类型\" prop=\"text\" borderBottom ref=\"text\">\r\n\t\t\t\t\t\t<u-input v-model=\"formData.text\" placeholder=\"请输入\" border=\"none\" @change=\"addWatermark\"></u-input>\r\n\t\t\t\t\t</u-form-item> -->\r\n\r\n\t\t\t\t\t<u-form-item label=\"经度\" prop=\"longitude\" borderBottom ref=\"text\">\r\n\t\t\t\t\t\t<u-input v-model=\"formData.longitude\" placeholder=\"请输入\" border=\"none\" @change=\"addWatermark\"></u-input>\r\n\t\t\t\t\t</u-form-item>\r\n\r\n\t\t\t\t\t<u-form-item label=\"纬度\" prop=\"latitude\" borderBottom ref=\"text\">\r\n\t\t\t\t\t\t<u-input v-model=\"formData.latitude\" placeholder=\"请输入\" border=\"none\" @change=\"addWatermark\"></u-input>\r\n\t\t\t\t\t</u-form-item>\r\n\r\n\t\t\t\t\t<u-form-item label=\"地址\" prop=\"address\" borderBottom ref=\"text\">\r\n\t\t\t\t\t\t<u-input v-model=\"formData.address\" placeholder=\"请输入\" border=\"none\" @change=\"addWatermark\"></u-input>\r\n\t\t\t\t\t</u-form-item>\r\n\r\n\t\t\t\t\t<u-form-item label=\"备注\" prop=\"notes\" borderBottom ref=\"text\">\r\n\t\t\t\t\t\t<u-input v-model=\"formData.notes\" placeholder=\"请输入\" border=\"none\" @change=\"addWatermark\"></u-input>\r\n\t\t\t\t\t</u-form-item>\r\n\r\n\t\t\t\t\t<!-- <u-form-item label=\"水印文字\" prop=\"text\" borderBottom ref=\"text\">\r\n\t\t\t\t\t\t<u-input v-model=\"formData.text\" placeholder=\"请输入\" border=\"none\" @change=\"addWatermark\"></u-input>\r\n\t\t\t\t\t</u-form-item>\r\n\t\t\t\t\t<u-form-item label=\"水印透明度\" prop=\"opacity\" borderBottom ref=\"text\">\r\n\t\t\t\t\t\t<view style=\"display: flex;align-items: center;\">\r\n\t\t\t\t\t\t\t<view style=\"width: 83%\">\r\n\t\t\t\t\t\t\t\t<u-slider v-model=\"formData.opacity\" @changing=\"(e)=> formData.opacity = e\" min=\"1\"\r\n\t\t\t\t\t\t\t\t\tmax=\"100\"></u-slider>\r\n\t\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t\t\t{{`${formData.opacity} %`}}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</u-form-item>\r\n\t\t\t\t\t<u-form-item label=\"水印旋转\" prop=\"angle\" borderBottom ref=\"text\">\r\n\t\t\t\t\t\t<view style=\"display: flex;align-items: center;\">\r\n\t\t\t\t\t\t\t<view style=\"width: 83%\">\r\n\t\t\t\t\t\t\t\t<u-slider v-model=\"formData.angle\" @changing=\"(e)=> formData.angle = e\" min=\"1\"\r\n\t\t\t\t\t\t\t\t\tmax=\"100\"></u-slider>\r\n\t\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t\t\t{{`${formData.angle} C`}}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</u-form-item>\r\n\t\t\t\t\t<u-form-item label=\"水印密度\" prop=\"density\" borderBottom ref=\"text\">\r\n\t\t\t\t\t\t<view style=\"display: flex;align-items: center;\">\r\n\t\t\t\t\t\t\t<view style=\"width: 83%\">\r\n\t\t\t\t\t\t\t\t<u-slider v-model=\"formData.density\" @changing=\"(e)=> formData.density = e\" min=\"1\"\r\n\t\t\t\t\t\t\t\t\tmax=\"100\"></u-slider>\r\n\t\t\t\t\t\t\t</view>\r\n\r\n\t\t\t\t\t\t\t{{`${formData.density} %`}}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</u-form-item> -->\r\n\t\t\t\t</u-form>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</page>\r\n\r\n</template>\r\n\r\n<style scoped lang=\"less\">\r\n\t.content {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tpadding: 10px;\r\n\t\theight: calc(100vh - 20px);\r\n\t\tbackground: #e8e8e8;\r\n\r\n\t\t.content-main {\r\n\t\t\tposition: relative;\r\n\t\t\twidth: 100vw;\r\n\t\t\theight: 600px;\r\n\t\t\tborder-radius: 6px;\r\n\t\t\tbackground: #ffffff;\r\n\t\t\t\r\n\t\t\t.watermark-canvas {\r\n\t\t\t\topacity: 1;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\t.watermark-text {\r\n\t\t\t\t\tz-index: 200;\r\n\t\t\t\t\twidth: 100%;\r\n\t\t\t\t\theight: 100%;\r\n\t\t\t\t\tposition: relative;\r\n\t\t\t\t\t// background-color: aquamarine;\r\n\t\t\t\t\tmargin: 20px;\r\n\t\t\t\t\t.sign {\r\n\t\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\t\ttop: 50%;\r\n\t\t\t\t\t\tleft: 50%;\r\n\t\t\t\t\t\ttransform: translate(-50%, -50%);\r\n\t\t\t\t\t\tcolor: rgb(0 0 0 / 17%);\r\n\t\t\t\t\t\t// border: 1px solid aliceblue;\r\n\t\t\t\t\t\tfont-size: 30px;\r\n\t\t\t\t\t\tfont-weight: 600;\r\n\t\t\t\t\t\tpointer-events: none; /* 确保水印不影响交互 */\r\n\t\t\t\t\t\topacity: 0.2;\r\n\t\t\t\t\t\t -webkit-text-stroke: 1px white; /* 给文字添加边框 */\r\n\t\t\t\t\t\ttext-stroke: 1px white; /* 标准属性，但不广泛支持 */\r\n\t\t\t\t\t}\r\n\t\t\t\t\t.text {\r\n\t\t\t\t\t\tposition: absolute;\r\n\t\t\t\t\t\tbottom: 0%;\r\n\t\t\t\t\t\tleft: 0%;\r\n\t\t\t\t\t\tcolor: #ffffff;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.watermark-canvas-image {\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: 0;\r\n\t\t\t\tz-index: 100;\r\n\t\t\t\topacity: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.watermark-container {\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\twidth: calc(100vw - 40px);\r\n\t\t\t\theight: calc(100vw - 40px);\r\n\t\t\t\tpadding: 10px;\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: 0px;\r\n\t\t\t\tfont-size: 25px;\r\n\t\t\t\tcolor: rgba(0, 0, 0, 0.2);\r\n\t\t\t\toverflow: hidden;\r\n\r\n\t\t\t\t.watermark {\r\n\t\t\t\t\twhite-space: nowrap;\r\n\t\t\t\t\tmargin: 0 auto;\r\n\t\t\t\t\ttransform: translate(-50%, -50%) rotate(-30deg);\r\n\t\t\t\t\t/* 居中并旋转 */\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.iamge {\r\n\t\t\t\twidth: calc(100vw - 40px);\r\n\t\t\t\theight: calc(100vw - 40px);\r\n\t\t\t\tpadding: 10px;\r\n\t\t\t}\r\n\r\n\t\t\t.preview-main-bottom {\r\n\t\t\t\tz-index: 100;\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: 0px;\r\n\t\t\t\twidth: calc(100vw - 20px);\r\n\t\t\t\theight: calc(100vw - 20px);\r\n\t\t\t\tdisplay: node;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t.controlPanel {\r\n\t\t\tmargin-top: 10px;\r\n\t\t\twidth: calc(100vw - 40px);\r\n\t\t\tpadding: 10px;\r\n\t\t\toverflow-y: auto;\r\n\t\t\tborder-radius: 6px;\r\n\t\t\tbackground: #ffffff;\r\n\t\t}\r\n\t}\r\n</style>\r\n","import MiniProgramPage from '/Users/pq/code/ph/pages/home/ph/addWatermark/addWatermark.vue'\nwx.createPage(MiniProgramPage)"],"names":["getCurrentInstance","ref","uni","onLoad","nextTick","onMounted","dayjs","reactive","res"],"mappings":"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"}