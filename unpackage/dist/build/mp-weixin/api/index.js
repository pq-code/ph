"use strict";const e=require("../common/vendor.js"),r=(require("./service/wxService.js"),require("../utils/index.js")),o=require("./error/errTips.js"),t={get:(e,r)=>n(e,r,"get"),post:(e,r)=>n(e,r,"post"),patch:(e,r)=>n(e,r,"patch")};async function n(t,n={},i){e.index.getSystemInfoSync(),n&&!n.hideLoading&&e.index.showLoading({title:"加载中..."});try{return(async(t,n,i)=>{let s="login";return s=t.startsWith("users")?"login":"koa-0jh8",new Promise((async(a,c)=>{const d=(await e.wx$1.cloud.callContainer({config:{env:"prod-8gqm1nbtf8eae76e"},path:t,header:{"X-WX-SERVICE":s,authorization:e.index.getStorageSync("token")},method:i,data:n})).data;0==d.code?a(d):"10101"==d.error?(r.showToast("token已过期重新登录"),r.wxUserlLogin().then((e=>{console.log("res",e),a(e)}),(e=>{c(e)}))):(r.showToast(o.errTips[d.error]||d.message||"未知错误"),c(d))}))})(t,n,i)}catch(s){return console.error(s),Promise.reject(s)}finally{n&&!n.hideLoading&&e.index.hideLoading()}}exports.http=t;
