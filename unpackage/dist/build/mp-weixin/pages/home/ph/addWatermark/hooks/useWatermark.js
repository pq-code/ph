"use strict";const e=require("../../../../../common/vendor.js");exports.useWatermark=t=>({addWatermark:async({image:a,style:s,info:r})=>{if(null==a?void 0:a.path)try{const s=e.index.createCanvasContext(t);s.clearRect(0,0,a.canvasWidth,a.canvasHeight),s.drawImage(a.path,a.x,a.y,a.drawWidth,a.drawHeight);const i={x:a.x,y:a.y,drawWidth:a.drawWidth,drawHeight:a.drawHeight};((e,t)=>{const{x:a,y:s,drawWidth:r,drawHeight:i}=t;e.save();const l=a+r/2,o=s+i/2,n=.08*Math.min(r,i);e.translate(l,o),e.setTextAlign("center"),e.setTextBaseline("middle"),e.setFontSize(n),e.font=`bold ${n}px sans-serif`;const d="现场拍照";e.setGlobalAlpha(.5),e.setLineWidth(2),e.setStrokeStyle("#FFFFFF"),e.strokeText(d,0,0),e.setGlobalAlpha(.5),e.setFillStyle("#666666"),e.fillText(d,0,0),e.restore()})(s,i),((t,a,s)=>{const{x:r,y:i,drawWidth:l,drawHeight:o}=a;t.setFontSize(14),t.setTextAlign("left"),t.setTextBaseline("top");const n=[`经度：${s.longitude||"121.0126"}`,`纬度：${s.latitude||"31.288511"}`,"坐标：WGS84坐标系",`地址：${s.address||""}`,`时间：${e.dayjs().format("YYYY-MM-DD HH:mm:ss")}`,`备注：${s.remark||"编辑备注"}`];let d=i+o-21*n.length-10;t.setGlobalAlpha(1),t.setFillStyle("#FFFFFF"),n.forEach((e=>{t.fillText(e,r+10,d),d+=21}))})(s,i,r),await new Promise((e=>s.draw(!1,e)))}catch(i){console.error("绘制失败:",i),e.index.showToast({title:"绘制失败",icon:"none"})}else console.error("无效的图片路径")}});
