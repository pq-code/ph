"use strict";const e=require("../../../../../common/vendor.js");exports.useImageHandler=()=>{const t=e.ref(null),i=e.ref(null),a=e.ref(!1);return{imageInfo:t,isProcessing:a,handleImageSelect:async()=>{try{a.value=!0;const{tempFiles:n}=await e.index.chooseImage({count:1,sizeType:["original"],sourceType:["album"]}),r=n[0],o=await new Promise((t=>{e.index.createSelectorQuery().select(".content-main").boundingClientRect((e=>{t(e)})).exec()})),h=await new Promise(((t,i)=>{e.index.getImageInfo({src:r.path,success:t,fail:i})})),{drawWidth:s,drawHeight:c,x:l,y:d}=((e,t,i,a)=>{const n=i/a;let r,o,h,s;return n>e/t?(r=e,o=e/n,h=0,s=(t-o)/2):(o=t,r=t*n,h=(e-r)/2,s=0),{drawWidth:r,drawHeight:o,x:h,y:s}})(o.width,o.height,h.width,h.height);return i.value=r,t.value={path:r.path,width:h.width,height:h.height,x:l,y:d,drawWidth:s,drawHeight:c,canvasWidth:o.width,canvasHeight:o.height},console.log("图片信息:",t.value),t.value}catch(n){console.error("选择图片失败:",n),e.index.showToast({title:"选择图片失败",icon:"none"})}finally{a.value=!1}}}};
