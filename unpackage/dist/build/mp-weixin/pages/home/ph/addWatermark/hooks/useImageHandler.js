"use strict";const e=require("../../../../../common/vendor.js");exports.useImageHandler=()=>{const t=e.ref({canvasWidth:0,canvasHeight:0,url:""}),a=e.ref(null),i=e.ref(!1);return{imageInfo:t,isProcessing:i,handleImageSelect:async()=>{try{i.value=!0;const{tempFiles:r}=await e.index.chooseImage({count:1,sizeType:["original"],sourceType:["album"]}),n=r[0],h=await new Promise((t=>{e.index.createSelectorQuery().select(".preview-wrapper").boundingClientRect((e=>{t(e)})).exec()})),s=await new Promise(((t,a)=>{e.index.getImageInfo({src:n.path,success:t,fail:a})})),{drawWidth:o,drawHeight:c,x:l,y:d}=((e,t,a,i)=>{const r=a/i;let n,h,s,o;return r>e/t?(n=e,h=e/r,s=0,o=(t-h)/2):(h=t,n=t*r,s=(e-n)/2,o=0),{drawWidth:n,drawHeight:h,x:s,y:o}})(h.width,h.height,s.width,s.height);return a.value=n,t.value={path:n.path,width:s.width,height:s.height,x:l,y:d,drawWidth:o,drawHeight:c,canvasWidth:h.width,canvasHeight:h.height},console.log("图片信息:",t.value),t.value}catch(r){console.error("选择图片失败:",r),e.index.showToast({title:"选择图片失败",icon:"none"})}finally{i.value=!1}}}};
