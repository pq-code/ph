"use strict";const e=require("../../../../common/vendor.js");if(!Array){(e.resolveComponent("u-picker")+e.resolveComponent("u-input")+e.resolveComponent("u-form-item")+e.resolveComponent("u-image")+e.resolveComponent("u-slider")+e.resolveComponent("u-form"))()}Math||((()=>"../../../../uni_modules/uview-plus/components/u-picker/u-picker.js")+(()=>"../../../../uni_modules/uview-plus/components/u-input/u-input.js")+(()=>"../../../../uni_modules/uview-plus/components/u-form-item/u-form-item.js")+(()=>"../../../../uni_modules/uview-plus/components/u-image/u-image.js")+(()=>"../../../../uni_modules/uview-plus/components/u-slider/u-slider.js")+(()=>"../../../../uni_modules/uview-plus/components/u-form/u-form.js")+a)();const a=()=>"../../../../components/pages/page.js",t={__name:"addWatermark",setup(a){const t=e.getCurrentInstance(),o=e.ref({url:"",status:"success",message:0}),l=e.ref({test:"",image:"",opacity:"",angle:-45,density:""}),i=e.ref({width:"",height:""}),s=()=>{const a=e.index.createCanvasContext("watermark");a.clearRect(0,0,i.value.width,i.value.height),a.draw()};e.onLoad((()=>{r.value=!0,e.nextTick$1((()=>{r.value=!1}))})),e.onMounted((()=>{e.index.createSelectorQuery().in(t.proxy).select("#contentMain").boundingClientRect((e=>{e&&(console.log("元素的宽："+e.width),console.log("元素的高："+e.height),i.value={width:e.width,height:e.height})})).exec()}));const n=a=>new Promise(((t,o)=>{e.index.getImageInfo({src:a,success:t,fail:o})})),u=async()=>{const a=o.value.width||100,t=o.value.height||100,i=o.value.x||0,n=o.value.y||0,u=e.index.createCanvasContext("watermark");if(s(),await u.drawImage(o.value.url,i,n,a,t),console.log("imageInfo",o.value.url,i,n,a,t),l.value.text){let e=l.value.fontSize||20;const o=l.value.angle*Math.PI/180;u.textAlign="center",u.font=`${e}px Arial`,u.fillStyle=`rgba(50, 50, 50, ${l.value.opacity||.3})`;for(let i=0;i<15;i++){u.save();const e=i%5*(a/2),s=Math.floor(i/5)*(t/2);u.translate(e+a/2,s+t/2),u.rotate(o),u.fillText(l.value.text,0,0),u.restore()}u.restore()}else u.drawImage(l.value.image.url,0,0,10,l.value.image.height*l.value.image.width/10);u.draw(!0,(()=>{}))},r=e.ref(!1),c=e.reactive([[{label:"添加图片/编辑图片",value:1},{label:"预览图片",value:2}]]),m=a=>{var t;1==a.value[0].value?e.index.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:async function(a){s();const t=i.value.width,l=i.value.height,u=await n(a.tempFilePaths[0]);let c=u.width,m=u.height,p=1;p=c>m?c/t:m/l,c/=p,m/=p;let v=(t-c)/2,d=(l-m)/2;const g=e.index.createCanvasContext("watermark");g.imageSmoothingEnabled=!1,await g.drawImage(u.path,v,d,c,m),await g.draw(!0),o.value={url:u.path,width:c,height:m,x:v,y:d,status:"success",message:0},r.value=!1},fail:function(a){console.log(a.errMsg),e.index.showToast({title:"选择图片失败",icon:"none"})}}):(t=o.value.url,e.index.previewImage({urls:[t],current:1,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){},fail:function(a){console.log(a.errMsg),e.index.showToast({title:"预览失败",icon:"none"})}}}))},p=()=>{e.index.canvasToTempFilePath({canvasId:"watermark",success:a=>{const t=a.tempFilePath;e.index.previewImage({current:t,urls:[t],success:()=>{},fail:()=>{}})},fail:a=>{console.error("合并图片失败:",a),e.index.showToast({title:"合并图片失败",icon:"none"})}})};return(a,t)=>({a:e.o((e=>r.value=!1)),b:e.o(m),c:e.p({show:r.value,columns:c,keyName:"label",closeOnClickOverlay:!0}),d:i.value.width+"px",e:i.value.height+"px",f:e.o((e=>r.value=!0)),g:i.value.width+"px",h:i.value.height+"px",i:e.o(u),j:e.o((e=>l.value.text=e)),k:e.p({border:"none",modelValue:l.value.text}),l:e.sr("text","35186aa7-3,35186aa7-2"),m:e.p({label:"水印文字",prop:"text",borderBottom:!0}),n:e.o((t=>(a.item,void(l.value.image?e.index.previewImage({urls:[l.value.image],current:0,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){},fail:function(e){console.log(e.errMsg)}}}):e.index.chooseImage({count:1,sizeType:["original"],sourceType:["album"],success:async function(e){const a=await n(e.tempFilePaths[0]);l.value.image={url:e.tempFilePaths[0],width:a.width,height:a.height,status:"success"},u()}}))))),o:e.p({width:"40",height:"40",src:l.value.image}),p:e.sr("text","35186aa7-5,35186aa7-2"),q:e.p({label:"水印图片",prop:"image",borderBottom:!0}),r:e.o((e=>l.value.opacity=e)),s:e.o((e=>l.value.opacity=e)),t:e.p({min:"1",max:"100",modelValue:l.value.opacity}),v:e.t(`${l.value.opacity} %`),w:e.sr("text","35186aa7-7,35186aa7-2"),x:e.p({label:"水印透明度",prop:"opacity",borderBottom:!0}),y:e.o((e=>l.value.angle=e)),z:e.o((e=>l.value.angle=e)),A:e.p({min:"1",max:"100",modelValue:l.value.angle}),B:e.t(`${l.value.angle} C`),C:e.sr("text","35186aa7-9,35186aa7-2"),D:e.p({label:"水印旋转",prop:"angle",borderBottom:!0}),E:e.o((e=>l.value.density=e)),F:e.o((e=>l.value.density=e)),G:e.p({min:"1",max:"100",modelValue:l.value.density}),H:e.t(`${l.value.density} %`),I:e.sr("text","35186aa7-11,35186aa7-2"),J:e.p({label:"水印密度",prop:"density",borderBottom:!0}),K:e.sr("form1","35186aa7-2,35186aa7-1"),L:e.p({labelWidth:"100px",labelPosition:"left",labelAlign:"left",model:l.value}),M:e.o(p),N:e.p({title:"添加水印",rButton:"生成图片"})})}},o=e._export_sfc(t,[["__scopeId","data-v-35186aa7"]]);wx.createPage(o);
