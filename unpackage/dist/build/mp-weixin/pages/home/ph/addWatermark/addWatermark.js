"use strict";const e=require("../../../../common/vendor.js"),a=require("./hooks/useImageHandler.js"),o=require("./hooks/useWatermark.js"),s=require("./hooks/useWatermarkForm.js"),n=require("./components/watermarkConfig.js");if(!Array){e.resolveComponent("u-icon")()}Math||((()=>"../../../../uni_modules/uview-plus/components/u-icon/u-icon.js")+r+i+t)();const t=()=>"../../../../components/pages/page.js",r=()=>"./components/WatermarkTypeSelector.js",i=()=>"./components/WatermarkForm.js",l={__name:"addWatermark",setup(t){const r=e.ref(1),i=e.ref(n.WATERMARK_TYPES[0].style),{imageInfo:l,isProcessing:u,handleImageSelect:c}=a.useImageHandler(),{addWatermark:m}=o.useWatermark("watermark"),{formData:d,getFormFields:v,validateForm:f,resetForm:p}=s.useWatermarkForm(),h=e=>{console.log("style",e),i.value=e.style,r.value=e.id,l.value&&g()},g=async()=>{console.log("formData",d.value),l.value&&i.value&&await m({image:l.value,style:i.value,info:d.value})},w=async()=>{if(u.value)return;await c()&&await g()},k=async()=>{if(l.value)try{const{x:a,y:o,drawWidth:s,drawHeight:n}=l.value,{tempFilePath:t}=await e.index.canvasToTempFilePath({canvasId:"watermark",fileType:"png",quality:1,x:a+.1,y:o+.1,width:s-.5,height:n-.5});console.log("生成图片成功",t),e.index.showToast({title:"生成图片成功",icon:"success"}),e.index.previewImage({urls:[t],longPressActions:{itemList:["保存图片"],success:function(a){0===a.tapIndex&&e.index.saveImageToPhotosAlbum({filePath:t,success:function(){e.index.showToast({title:"保存成功",icon:"success"})},fail:function(a){console.error("保存失败",a),e.index.showToast({title:"保存失败",icon:"none"})}})},fail:function(e){console.error("长按操作失败",e)}}})}catch(a){console.error("生成图片出错",a),e.index.showToast({title:"生成图片出错",icon:"none"})}else e.index.showToast({title:"请先选择图片",icon:"none"})};return(a,o)=>{var s,n;return e.e({a:(null==(s=e.unref(l))?void 0:s.canvasWidth)+"px",b:(null==(n=e.unref(l))?void 0:n.canvasHeight)+"px",c:!e.unref(l)},e.unref(l)?{}:{d:e.p({name:"camera-fill",size:"40",color:"#999"})},{e:e.o(w),f:e.o(h),g:e.o((e=>r.value=e)),h:e.p({modelValue:r.value}),i:i.value},i.value?{j:e.o(g),k:e.o((a=>e.isRef(d)?d.value=a:null)),l:e.p({fields:e.unref(v)(i.value),disabled:e.unref(u),modelValue:e.unref(d)})}:{},{m:e.o(k),n:e.p({title:"添加水印",rButton:"生成图片",rButtonDisabled:e.unref(u)})})}}},u=e._export_sfc(l,[["__scopeId","data-v-aaa81381"]]);wx.createPage(u);
