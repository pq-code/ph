"use strict";const e=require("../../../../common/vendor.js");if(!Array){(e.resolveComponent("u-picker")+e.resolveComponent("u-image")+e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("u-form-item")+e.resolveComponent("u-slider")+e.resolveComponent("u-form"))()}Math||(a+(()=>"../../../../uni_modules/uview-plus/components/u-picker/u-picker.js")+(()=>"../../../../uni_modules/uview-plus/components/u-image/u-image.js")+(()=>"../../../../uni_modules/uview-plus/components/u-input/u-input.js")+(()=>"../../../../uni_modules/uview-plus/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/uview-plus/components/u-form-item/u-form-item.js")+(()=>"../../../../uni_modules/uview-plus/components/u-slider/u-slider.js")+(()=>"../../../../uni_modules/uview-plus/components/u-form/u-form.js")+l)();const a=()=>"../../components/imageCropper/imageCropper2.js",l=()=>"../../../../components/pages/page.js",u={__name:"jigsawPuzzle",setup(a){const l=e.getCurrentInstance(),u=e.ref({width:0,height:0}),t=e.ref(5),i=e.ref(),s=e.ref(),o=e.ref(!1);e.ref(1);const n=e.reactive({imageTypeText:"九宫格",imageType:1,scale:1}),v=e.ref(!1),r=e.ref([]),h=e.ref([]);e.onLoad((()=>{v.value=!0,w.value=!0,e.nextTick$1((()=>{w.value=!1,v.value=!1}))})),e.onMounted((()=>{e.index.createSelectorQuery().in(l.proxy).select("#contentMain").boundingClientRect((e=>{e&&(console.log("元素的宽："+e.width),console.log("元素的高："+e.height),u.value={width:e.width,height:e.height}),m()})).exec()}));const c=()=>{const e=.3*(u.value.width-t.value),a=(u.value.height-2*t.value)/3,l=.7*(u.value.width-t.value),i=(u.value.height-t.value)/2;r.value=new Array(5).fill({}).map(((u,s)=>s<3?{width:e,height:a,x:0,y:s*(a+t.value),url:""}:{width:l,height:i,x:e+t.value,y:(s-3)*(i+t.value),url:""})),h.value=JSON.parse(JSON.stringify(r.value))},d=()=>{const e=.3*(u.value.width-t.value),a=(u.value.height-2*t.value)/3,l=.7*(u.value.width-t.value),i=(u.value.height-t.value)/2;r.value=new Array(5).fill({}).map(((u,s)=>s<2?{width:l,height:i,x:0,y:s*(i+t.value),url:""}:{width:e,height:a,x:l+t.value,y:(s-2)*(a+t.value),url:""})),h.value=JSON.parse(JSON.stringify(r.value))},m=()=>{const e=(u.value.width-2*t.value)/3,a=(u.value.height-2*t.value)/3;r.value=new Array(9).fill({}).map(((l,u)=>{let i=Math.floor(u/3),s=u%3*(e+t.value),o=i*(a+t.value);return{width:e,height:a,x:s,y:o,url:""}})),h.value=JSON.parse(JSON.stringify(r.value))},p=()=>{const e=(u.value.width-t.value)/2,a=u.value.height;r.value=new Array(2).fill({}).map(((l,u)=>{let i=u%2*(e+t.value);return{width:e,height:a,x:i,y:0,url:""}})),h.value=JSON.parse(JSON.stringify(r.value))},g=()=>{const e=u.value.width,a=(u.value.height-t.value)/2;r.value=new Array(2).fill({}).map(((l,u)=>{let i=u%2*(a+t.value);return{width:e,height:a,x:0,y:i,url:""}})),h.value=JSON.parse(JSON.stringify(r.value))},w=e.ref(),f=e.reactive([[{label:"九宫格",value:1},{label:"九宫格(中间放大)",value:2},{label:"左右对称",value:3},{label:"上下对称",value:4},{label:"左三右二",value:5},{label:"左二右三",value:6}]]),y=e.reactive([[{label:"添加图片",value:1},{label:"编辑图片",value:2},{label:"预览图片",value:3},{label:"删除图片",value:4}]]);e.onPullDownRefresh((()=>{console.log("下拉刷新")})),e.onShow((()=>{}));const x=a=>{v.value=!1,1==a.value[0].value&&e.index.chooseImage({count:1,sizeType:["original"],sourceType:["album"],success:function(e){i.value=e.tempFilePaths[0],o.value=!0,r.value[s.value]={...r.value[s.value],url:e.tempFilePaths[0],status:"success",message:`${s.value}`}}}),2==a.value[0].value&&(i.value=r.value[s.value],o.value=!0),3==a.value[0].value&&e.index.previewImage({urls:h.value.map((e=>e.url)),current:s.value,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮,第"+(e.index+1)+"张图片")},fail:function(e){console.log(e.errMsg)}}}),4==a.value[0].value&&(h.value[s.value]={...h.value[s.value],url:"",status:"success",message:`${s.value}`},r.value[s.value]={...r.value[s.value],url:"",status:"success",message:`${s.value}`})},b=e=>{o.value=!1,h.value[s.value]={...h.value[s.value],url:e,status:"success",message:`${s.value}`}},C=async()=>{const a=u.value.width,l=u.value.height,t=e.index.createCanvasContext("myCanvas");t.setFillStyle("#e8e8e8"),t.fillRect(0,0,a,l);let i=JSON.parse(JSON.stringify(h.value));i.sort(((e,a)=>(e.zIndex||1)-(a.zIndex||1))),i.forEach(((e,a)=>{((e,a)=>{a.url?e.drawImage(a.url,a.x,a.y,a.width,a.height):(e.setFillStyle("white"),e.fillRect(a.x,a.y,a.width,a.height))})(t,e)})),t.draw(!0,(()=>{e.index.canvasToTempFilePath({canvasId:"myCanvas",success:a=>{const l=a.tempFilePath;e.index.previewImage({current:l,urls:[l],success:()=>{T()},fail:()=>{T()}})},fail:a=>{console.error("合并图片失败:",a),e.index.showToast({title:"合并图片失败",icon:"none"})}})}))},T=()=>{const a=e.index.createCanvasContext("myCanvas");a.clearRect(0,0,u.value.width,u.value.height),a.draw()},I=()=>{const a=r.value.length;e.index.chooseImage({count:a,sizeType:["original"],sourceType:["album"],success:async function(a){for(let t=0;t<a.tempFilePaths.length;t++)try{const l=e.index.createCanvasContext("myCanvas"),{width:i,height:s}=h.value[t],o=i/s;r.value[t]={...r.value[t],url:a.tempFilePaths[t],status:"success",message:`${t}`};const n=await S(a.tempFilePaths[t]);let v=n.width,c=n.height,d=0,m=0;v/c>o?(v=c*o,d=(n.width-v)/2):(c=v/o,m=(n.height-c)/2),l.imageSmoothingEnabled=!1,await l.drawImage(a.tempFilePaths[t],d,m,v,c,0,0,u.value.width,u.value.height),await l.draw(!0);const p=(await e.index.canvasToTempFilePath({canvasId:"myCanvas"})).tempFilePath;await l.clearRect(0,0,u.value.width,u.value.height),await l.draw(),console.log("cropImage",p),h.value[t]={...h.value[t],url:p,status:"success",message:`${t}`}}catch(l){console.error("处理图片失败: ",l),r.value[t]={...r.value[t],status:"error",message:l.message}}},fail:function(e){console.error("选择图片失败: ",e)}})},S=a=>new Promise(((l,u)=>{e.index.getImageInfo({src:a,success:l,fail:u})})),O=e=>{n.imageType=e.value[0].value,n.imageTypeText=e.value[0].label,w.value=!1,n.scale=1;const a={1:m,3:p,4:g,5:c,6:d}[n.imageType];a&&a()},P=e=>{n.scale=e;let a={x:h.value[3].x+h.value[3].width+t.value,y:h.value[3].y+h.value[3].height+t.value,width:0,height:0};const l=h.value[3].width,u=h.value[3].height,i=e/100+1;a.width=l*i,a.height=u*i;const s=a.x-(a.width-l)/2,o=a.y-(a.height-u)/2;a.x=s,a.y=o,h.value[4]={...h.value[4],x:a.x,y:a.x,width:a.width,height:a.height,zIndex:700}};return(a,l)=>e.e({a:o.value,b:e.o(b),c:e.p({cropImage:i.value}),d:e.o((e=>w.value=!1)),e:e.o(O),f:e.p({show:w.value,columns:f,keyName:"label",closeOnClickOverlay:!0}),g:e.o((e=>v.value=!1)),h:e.o(x),i:e.p({show:v.value,columns:y,keyName:"label",closeOnClickOverlay:!0}),j:e.f(h.value,((a,l,u)=>({a:"061dadfd-4-"+u+",061dadfd-0",b:e.p({height:`${a.height}px`,width:`${a.width}px`,mode:"aspectFill",src:a.url}),c:a.url||l,d:`${a.width}px`,e:`${a.height}px`,f:`${a.y}px`,g:`${a.x}px`,h:`${a.zIndex||666}`,i:e.o((e=>((e,a)=>{v.value=!0,s.value=a})(0,l)),a.url||l)}))),k:u.value.width+"px",l:u.value.height+"px",m:e.o((e=>n.imageTypeText=e)),n:e.p({disabled:!0,disabledColor:"#ffffff",placeholder:"请选择",border:"none",modelValue:n.imageTypeText}),o:e.p({name:"arrow-right"}),p:e.sr("imageType","061dadfd-6,061dadfd-5"),q:e.o((e=>w.value=!0)),r:e.p({label:"选择拼图类型",prop:"imageType",borderBottom:!0,border:"none",placeholder:"请选择"}),s:2==n.imageType},2==n.imageType?{t:e.o(P),v:e.o((e=>n.scale=e)),w:e.p({min:"1",max:"100",modelValue:n.scale}),x:e.t(`${n.scale} %`),y:e.sr("text","061dadfd-9,061dadfd-5"),z:e.p({label:"中间图片大小",prop:"opacity",borderBottom:!0})}:{},{A:e.sr("form1","061dadfd-5,061dadfd-0"),B:e.p({labelWidth:"100px",labelPosition:"left",labelAlign:"left",model:n}),C:e.o(I),D:e.o(C),E:e.p({title:"拼图",lButton:"批量录入",rButton:"生成照片"})})}},t=e._export_sfc(u,[["__scopeId","data-v-061dadfd"]]);wx.createPage(t);
