"use strict";const e=require("../../../../common/vendor.js");if(!Array){(e.resolveComponent("u-picker")+e.resolveComponent("u-image")+e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("u-form-item")+e.resolveComponent("u-slider")+e.resolveComponent("u-form"))()}Math||(l+(()=>"../../../../uni_modules/uview-plus/components/u-picker/u-picker.js")+(()=>"../../../../uni_modules/uview-plus/components/u-image/u-image.js")+(()=>"../../../../uni_modules/uview-plus/components/u-input/u-input.js")+(()=>"../../../../uni_modules/uview-plus/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/uview-plus/components/u-form-item/u-form-item.js")+(()=>"../../../../uni_modules/uview-plus/components/u-slider/u-slider.js")+(()=>"../../../../uni_modules/uview-plus/components/u-form/u-form.js")+a)();const l=()=>"../../components/imageCropper/imageCropper2.js",a=()=>"../../../../components/pages/page.js",u={__name:"jigsawPuzzle",setup(l){const a=e.getCurrentInstance(),u=e.ref({width:0,height:0}),t=e.ref(5),s=e.ref(),i=e.ref(),o=e.ref(!1);e.ref(1);const n=e.reactive({imageTypeText:"九宫格",imageType:1,scale:1}),v=e.ref(!1),r=e.ref([]),h=e.ref([]);e.onLoad((()=>{v.value=!0,w.value=!0,e.nextTick$1((()=>{w.value=!1,v.value=!1}))})),e.onMounted((()=>{e.index.createSelectorQuery().in(a.proxy).select("#contentMain").boundingClientRect((e=>{e&&(console.log("元素的宽："+e.width),console.log("元素的高："+e.height),u.value={width:e.width,height:e.height}),m()})).exec()}));const c=()=>{const e=.3*(u.value.width-t.value),l=(u.value.height-2*t.value)/3,a=.7*(u.value.width-t.value),s=(u.value.height-t.value)/2;r.value=new Array(5).fill({}).map(((u,i)=>i<3?{width:e,height:l,x:0,y:i*(l+t.value),url:""}:{width:a,height:s,x:e+t.value,y:(i-3)*(s+t.value),url:""})),h.value=JSON.parse(JSON.stringify(r.value))},p=()=>{const e=.3*(u.value.width-t.value),l=(u.value.height-2*t.value)/3,a=.7*(u.value.width-t.value),s=(u.value.height-t.value)/2;r.value=new Array(5).fill({}).map(((u,i)=>i<2?{width:a,height:s,x:0,y:i*(s+t.value),url:""}:{width:e,height:l,x:a+t.value,y:(i-2)*(l+t.value),url:""})),h.value=JSON.parse(JSON.stringify(r.value))},m=()=>{const e=(u.value.width-2*t.value)/3,l=(u.value.height-2*t.value)/3;let a=new Array(9).fill({}).map(((a,u)=>{var s;let i=Math.floor(u/3),o=u%3*(e+t.value),n=i*(l+t.value);return{width:e,height:l,x:o,y:n,url:r.value[u]?null==(s=r.value[u])?void 0:s.url:""}}));r.value=JSON.parse(JSON.stringify(a)),h.value=JSON.parse(JSON.stringify(r.value))},g=()=>{const e=(u.value.width-t.value)/2,l=u.value.height;let a=new Array(2).fill({}).map(((a,u)=>{var s;let i=u%2*(e+t.value);return{width:e,height:l,x:i,y:0,url:r.value[u]?null==(s=r.value[u])?void 0:s.url:""}}));r.value=JSON.parse(JSON.stringify(a)),h.value=JSON.parse(JSON.stringify(r.value))},d=()=>{const e=u.value.width,l=(u.value.height-t.value)/2;r.value=new Array(2).fill({}).map(((a,u)=>{let s=u%2*(l+t.value);return{width:e,height:l,x:0,y:s,url:""}})),h.value=JSON.parse(JSON.stringify(r.value))},w=e.ref(),f=e.reactive([[{label:"九宫格",value:1,url:"@/assets/images/jgg.png"},{label:"九宫格(中间放大)",value:2,url:"@/assets/images/jgg.png"},{label:"左右对称",value:3,url:"@/assets/images/lr.png"},{label:"上下对称",value:4,url:""},{label:"左三右二",value:5,url:""},{label:"左二右三",value:6,url:""}]]),y=e.reactive([[{label:"添加图片",value:1},{label:"编辑图片",value:2},{label:"预览图片",value:3},{label:"删除图片",value:4}]]);e.onPullDownRefresh((()=>{console.log("下拉刷新")})),e.onShow((()=>{}));const x=l=>{v.value=!1,1==l.value[0].value&&e.index.chooseImage({count:1,sizeType:["original"],sourceType:["album"],success:function(e){s.value=e.tempFilePaths[0],o.value=!0,r.value[i.value]={...r.value[i.value],url:e.tempFilePaths[0],status:"success",message:`${i.value}`}}}),2==l.value[0].value&&(s.value=r.value[i.value],o.value=!0),3==l.value[0].value&&e.index.previewImage({urls:h.value.map((e=>e.url)),current:i.value,longPressActions:{itemList:["发送给朋友","保存图片","收藏"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮,第"+(e.index+1)+"张图片")},fail:function(e){console.log(e.errMsg)}}}),4==l.value[0].value&&(h.value[i.value]={...h.value[i.value],url:"",status:"success",message:`${i.value}`},r.value[i.value]={...r.value[i.value],url:"",status:"success",message:`${i.value}`})},b=e=>{o.value=!1,h.value[i.value]={...h.value[i.value],url:e,status:"success",message:`${i.value}`}},C=async()=>{const l=u.value.width,a=u.value.height,t=e.index.createCanvasContext("myCanvas");t.setFillStyle("#e8e8e8"),t.fillRect(0,0,l,a);let s=JSON.parse(JSON.stringify(h.value));s.sort(((e,l)=>(e.zIndex||1)-(l.zIndex||1))),s.forEach(((e,l)=>{((e,l)=>{l.url?e.drawImage(l.url,l.x,l.y,l.width,l.height):(e.setFillStyle("white"),e.fillRect(l.x,l.y,l.width,l.height))})(t,e)})),t.draw(!0,(()=>{e.index.canvasToTempFilePath({canvasId:"myCanvas",success:l=>{const a=l.tempFilePath;e.index.previewImage({current:a,urls:[a],success:()=>{T()},fail:()=>{T()}})},fail:l=>{console.error("合并图片失败:",l),e.index.showToast({title:"合并图片失败",icon:"none"})}})}))},T=()=>{const l=e.index.createCanvasContext("myCanvas");l.clearRect(0,0,u.value.width,u.value.height),l.draw()},S=()=>{const l=r.value.length;e.index.chooseImage({count:l,sizeType:["original"],sourceType:["album"],success:async function(l){for(let t=0;t<l.tempFilePaths.length;t++)try{const a=e.index.createCanvasContext("myCanvas"),{width:s,height:i}=h.value[t],o=s/i;r.value[t]={...r.value[t],url:l.tempFilePaths[t],status:"success",message:`${t}`};const n=await I(l.tempFilePaths[t]);let v=n.width,c=n.height,p=0,m=0;v/c>o?(v=c*o,p=(n.width-v)/2):(c=v/o,m=(n.height-c)/2),a.imageSmoothingEnabled=!1,await a.drawImage(l.tempFilePaths[t],p,m,v,c,0,0,u.value.width,u.value.height),await a.draw(!0);const g=(await e.index.canvasToTempFilePath({canvasId:"myCanvas"})).tempFilePath;await a.clearRect(0,0,u.value.width,u.value.height),await a.draw(),console.log("cropImage",g),h.value[t]={...h.value[t],url:g,status:"success",message:`${t}`}}catch(a){console.error("处理图片失败: ",a),r.value[t]={...r.value[t],status:"error",message:a.message}}},fail:function(e){console.error("选择图片失败: ",e)}})},I=l=>new Promise(((a,u)=>{e.index.getImageInfo({src:l,success:a,fail:u})})),O=e=>{e=e.value[0],n.imageType=e.value,n.imageTypeText=e.label,w.value=!1,n.scale=1;const l={1:m,2:m,3:g,4:d,5:c,6:p}[n.imageType];l&&l()},N=e=>{n.scale=e;let l={x:h.value[3].x+h.value[3].width+t.value,y:h.value[3].y+h.value[3].height+t.value,width:0,height:0};const a=h.value[3].width,u=h.value[3].height,s=e/100+1;l.width=a*s,l.height=u*s;const i=l.x-(l.width-a)/2,o=l.y-(l.height-u)/2;l.x=i,l.y=o,h.value[4]={...h.value[4],x:l.x,y:l.x,width:l.width,height:l.height,zIndex:700}},J=e=>{console.log(e),t.value=e;const l={1:m,3:g,4:d,5:c,6:p}[n.imageType];l&&l()};return(l,a)=>e.e({a:o.value,b:e.o(b),c:e.p({cropImage:s.value}),d:e.o((e=>w.value=!1)),e:e.o(O),f:e.p({show:w.value,columns:f,keyName:"label",closeOnClickOverlay:!0}),g:e.o((e=>v.value=!1)),h:e.o(x),i:e.p({show:v.value,columns:y,keyName:"label",closeOnClickOverlay:!0}),j:e.f(h.value,((l,a,u)=>({a:"d26eb1f9-4-"+u+",d26eb1f9-0",b:e.p({height:`${l.height}px`,width:`${l.width}px`,mode:"aspectFill",src:l.url}),c:l.url||a,d:`${l.width}px`,e:`${l.height}px`,f:`${l.y}px`,g:`${l.x}px`,h:`${l.zIndex||666}`,i:e.o((e=>((e,l)=>{v.value=!0,i.value=l,s.value=r.value[l].url})(0,a)),l.url||a)}))),k:u.value.width+"px",l:u.value.height+"px",m:e.o((e=>n.imageTypeText=e)),n:e.p({disabled:!0,disabledColor:"#ffffff",placeholder:"请选择",border:"none",modelValue:n.imageTypeText}),o:e.p({name:"arrow-right"}),p:e.sr("imageType","d26eb1f9-6,d26eb1f9-5"),q:e.o((e=>w.value=!0)),r:e.p({label:"选择拼图类型",prop:"imageType",borderBottom:!0,border:"none",placeholder:"请选择"}),s:e.o(J),t:e.o((e=>t.value=e)),v:e.p({min:"0",max:"10",modelValue:t.value}),w:e.t(`${t.value} %`),x:e.sr("text","d26eb1f9-9,d26eb1f9-5"),y:e.p({label:"间距",prop:"opacity",borderBottom:!0}),z:2==n.imageType},2==n.imageType?{A:e.o(N),B:e.o((e=>n.scale=e)),C:e.p({min:"1",max:"100",modelValue:n.scale}),D:e.t(`${n.scale} %`),E:e.sr("text","d26eb1f9-11,d26eb1f9-5"),F:e.p({label:"中间图片大小",prop:"opacity",borderBottom:!0})}:{},{G:e.sr("form1","d26eb1f9-5,d26eb1f9-0"),H:e.p({labelWidth:"100px",labelPosition:"left",labelAlign:"left",model:n}),I:e.o(S),J:e.o(C),K:e.p({title:"拼图",lButton:"批量录入",rButton:"生成照片"})})}},t=e._export_sfc(u,[["__scopeId","data-v-d26eb1f9"]]);wx.createPage(t);
