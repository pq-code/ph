"use strict";const e=require("../common/vendor.js"),o=require("../api/apis/user.js"),r=async()=>new Promise((async(r,s)=>{let n=await Promise.all([new Promise(((o,r)=>{e.index.login({provider:"weixin",searchFn:!0,onlyAuthorize:!0,success(e){o(e)},fail:e=>{r(e)}})}))]);console.log(n);let i={};if(n[0].code)try{if(i=await o.armorTransformation({code:n[0].code,userInfo:n[1]||{}}),0==i.code){const{token:o,userId:s,userName:n,userPassword:t,userSource:a,userSourceID:c,userNickname:u,userInfo:d,userProfilePhoto:l,sessionKey:f}=i.result;e.index.setStorageSync("token",o),e.index.setStorageSync("userInfo",{userId:s,userName:n,userPassword:t,userSource:a,userSourceID:c,userNickname:u,userInfo:d,userProfilePhoto:l,sessionKey:f}),e.index.hideLoading(),r(i)}else console.error("登录失败:",err),e.index.hideLoading(),s(i)}catch(t){console.error("登录失败:",t),e.index.hideLoading(),s(i)}}));exports.getLoginFn=async()=>{try{let e=await o.getUerInfo();if(0==e.code)return new Promise(((o,r)=>{o(e)}))}catch(e){return r()}},exports.showToast=o=>{e.index.showToast({icon:"none",position:"center",title:o})},exports.wxUserlLogin=r;
