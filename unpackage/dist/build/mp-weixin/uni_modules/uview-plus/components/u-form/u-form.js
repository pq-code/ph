"use strict";const e=require("../../../../common/vendor.js"),i=require("./props.js"),t=require("../../libs/mixin/mpMixin.js"),n=require("../../libs/mixin/mixin.js"),r=require("../../libs/util/async-validator.js");r.Schema.warning=function(){};const s={name:"u-form",mixins:[t.mpMixin,n.mixin,i.props],provide(){return{uForm:this}},data:()=>({formRules:{},validator:{},originalModel:null}),watch:{rules:{immediate:!0,handler(e){this.setRules(e)}},propsChange(e){var i;(null==(i=this.children)?void 0:i.length)&&this.children.map((e=>{"function"==typeof e.updateParentData&&e.updateParentData()}))},model:{immediate:!0,handler(i){this.originalModel||(this.originalModel=e.index.$u.deepClone(i))}}},computed:{propsChange(){return[this.errorType,this.borderBottom,this.labelPosition,this.labelWidth,this.labelAlign,this.labelStyle]}},created(){this.children=[]},methods:{setRules(e){0!==Object.keys(e).length&&(this.formRules=e,this.validator=new r.Schema(e))},resetFields(){this.resetModel()},resetModel(i){this.children.map((i=>{const t=null==i?void 0:i.prop,n=e.index.$u.getProperty(this.originalModel,t);e.index.$u.setProperty(this.model,t,n)}))},clearValidate(e){e=[].concat(e),this.children.map((i=>{(void 0===e[0]||e.includes(i.prop))&&(i.message=null)}))},async validateField(i,t,n=null){this.$nextTick((()=>{const s=[];i=[].concat(i),this.children.map((t=>{const o=[];if(i.includes(t.prop)){const i=e.index.$u.getProperty(this.model,t.prop),l=t.prop.split("."),a=l[l.length-1],d=this.formRules[t.prop];if(!d)return;const h=[].concat(d);for(let c=0;c<h.length;c++){const l=h[c],d=[].concat(null==l?void 0:l.trigger);if(n&&!d.includes(n))continue;new r.Schema({[a]:l}).validate({[a]:i},((i,n)=>{var r;e.index.$u.test.array(i)&&(s.push(...i),o.push(...i)),t.message=(null==(r=o[0])?void 0:r.message)??null}))}}})),"function"==typeof t&&t(s)}))},validate(i){return new Promise(((i,t)=>{this.$nextTick((()=>{const n=this.children.map((e=>e.prop));this.validateField(n,(n=>{n.length?("toast"===this.errorType&&e.index.$u.toast(n[0].message),t(n)):i(!0)}))}))}))}}};const o=e._export_sfc(s,[["render",function(e,i,t,n,r,s){return{}}]]);wx.createComponent(o);
